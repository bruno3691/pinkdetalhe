<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Painel ADM Wepink</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Open+Sans:wght@400;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">

    <script>
        (function() {
            const settings = JSON.parse(localStorage.getItem('wipinkSettings'));
            if (!settings) return;

            const root = document.documentElement;

            // 1. Aplicar Cores
            if (settings.primaryColor) root.style.setProperty('--wepink-pink', settings.primaryColor);
            if (settings.darkColor) root.style.setProperty('--wepink-pink-dark', settings.darkColor);
            if (settings.bgColor) root.style.setProperty('--wepink-bg', settings.bgColor);
            if (settings.textColor) root.style.setProperty('--wepink-text', settings.textColor);

            // 2. Aplicar Fonte
            let fontFamily = '';
            if (settings.font === 'roboto') fontFamily = "'Roboto', sans-serif";
            else if (settings.font === 'montserrat') fontFamily = "'Montserrat', sans-serif";
            else if (settings.font === 'opensans') fontFamily = "'Open Sans', sans-serif";
            else fontFamily = '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif'; // Padrão
            
            root.style.setProperty('--wepink-font-family', fontFamily);
        })();
    </script>
    
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
    <style>
        /* Variáveis de Cor da Wepink */
        :root {
            --wepink-pink: #FF0092; 
            --wepink-pink-dark: #C90076;
            --wepink-pink-light: #FFDDEB; 
            --wepink-bg: #F8F9FA; /* Fundo do Dashboard */
            --wepink-white: #FFFFFF; 
            --wepink-text: #222222; 
            --wepink-text-light: #6A6A6A; 
            --wepink-border: #E0E0E0; 
            --wepink-font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }

        /* Estilos Globais */
        body {
            font-family: var(--wepink-font-family); /* USA A FONTE DINÂMICA */
            margin: 0;
            padding: 0;
            background-color: var(--wepink-bg);
            color: var(--wepink-text);
            line-height: 1.6;
            display: flex; /* Habilita layout lateral */
        }
        
        /* --------------------------------- */
        /* --- 1. LOGIN --- */
        /* --------------------------------- */
        .admin-login {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            text-align: center;
            padding: 20px;
            width: 100%;
            background-color: var(--wepink-bg);
        }
        .admin-login h2 { font-size: 28px; color: var(--wepink-pink); margin-bottom: 25px; font-weight: 700; }
        .admin-login input[type="password"] { width: 100%; max-width: 300px; padding: 12px 15px; margin-bottom: 15px; border: 1px solid var(--wepink-border); border-radius: 8px; font-size: 16px; outline: none; transition: border-color 0.3s; }
        .admin-login input[type="password"]:focus { border-color: var(--wepink-pink); }
        #loginButton { background-color: var(--wepink-pink); color: var(--wepink-white); border: none; padding: 12px 30px; font-size: 16px; font-weight: 600; border-radius: 8px; cursor: pointer; transition: background-color 0.3s; width: 100%; max-width: 300px; }
        #loginButton:hover { background-color: var(--wepink-pink-dark); }
        
        
        /* --------------------------------- */
        /* --- 2. LAYOUT DO DASHBOARD --- */
        /* --------------------------------- */
        .admin-container {
            flex-grow: 1;
            display: flex;
            min-height: 100vh;
        }

        /* SIDEBAR DE NAVEGAÇÃO */
        .sidebar {
            width: 250px;
            background-color: var(--wepink-white);
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.05);
            padding: 20px 0;
            display: flex;
            flex-direction: column;
        }
        
        .sidebar-logo {
            text-align: center;
            font-size: 24px;
            font-weight: 800;
            color: var(--wepink-pink);
            margin-bottom: 30px;
            text-transform: uppercase;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            text-decoration: none;
            color: var(--wepink-text);
            font-size: 15px;
            font-weight: 500;
            transition: background-color 0.2s, color 0.2s;
            border-left: 3px solid transparent;
        }

        .nav-link i {
            margin-right: 10px;
            width: 20px;
            height: 20px;
            color: var(--wepink-text-light);
        }

        .nav-link:hover, .nav-link.active {
            background-color: var(--wepink-pink-light);
            color: var(--wepink-pink-dark);
            border-left: 3px solid var(--wepink-pink);
        }
        
        .nav-link:hover i, .nav-link.active i {
            color: var(--wepink-pink);
        }
        
        /* CONTEÚDO PRINCIPAL */
        .main-content {
            flex-grow: 1;
            padding: 30px;
            overflow-y: auto;
        }
        
        .main-content h1 {
            font-size: 28px;
            color: var(--wepink-text);
            margin-bottom: 25px;
            font-weight: 700;
        }

        /* --------------------------------- */
        /* --- 3. DASHBOARD METRICS --- */
        /* --------------------------------- */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .metric-card {
            background-color: var(--wepink-white);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .metric-card .value {
            font-size: 32px;
            font-weight: 700;
            color: var(--wepink-pink-dark);
        }
        
        .metric-card .label {
            font-size: 14px;
            color: var(--wepink-text-light);
            margin-top: 5px;
        }
        
        .metric-card i {
            width: 35px;
            height: 35px;
            color: var(--wepink-pink);
            stroke-width: 1.5;
        }

        /* --------------------------------- */
        /* --- 4. SEÇÕES DE CONFIGURAÇÃO/FORMULÁRIOS --- */
        /* --------------------------------- */
        .admin-sections {
            display: grid;
            grid-template-columns: 1fr;
            gap: 25px;
        }
        
        .admin-section {
            background-color: var(--wepink-white);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }
        
        .admin-section h2 {
            font-size: 20px;
            font-weight: 600;
            color: var(--wepink-text);
            margin-top: 0;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            border-bottom: 1px dashed var(--wepink-border);
            padding-bottom: 10px;
        }
        
        .admin-section h2 i {
            margin-right: 10px;
            color: var(--wepink-pink);
        }
        
        /* Estilos de inputs e botões (mantidos/aprimorados) */
        input[type="text"], input[type="color"], select, textarea, input[type="file"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid var(--wepink-border);
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s;
            font-family: var(--wepink-font-family);
        }
        
        input[type="color"] { padding: 0; height: 40px; }
        
        input:focus, select:focus, textarea:focus {
            border-color: var(--wepink-pink);
            box-shadow: 0 0 0 1px var(--wepink-pink);
        }
        
        .admin-section label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--wepink-text-light);
        }
        
        .wepink-btn {
            background-color: var(--wepink-pink);
            color: var(--wepink-white);
            border: none;
            padding: 10px 15px;
            font-size: 15px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
            display: inline-flex;
            align-items: center;
            font-family: var(--wepink-font-family);
        }
        
        .wepink-btn i { margin-right: 5px; }
        .wepink-btn:hover { background-color: var(--wepink-pink-dark); }
        
        /* Layouts de Grid para Formulários */
        .form-grid-2-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .form-grid-4-col {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }
        
        .radio-group { display: flex; gap: 15px; margin-bottom: 15px; }
        .radio-group label { display: flex; align-items: center; gap: 5px; font-size: 14px; color: var(--wepink-text); }
        
        .logo-preview-box {
            border: 1px dashed var(--wepink-border);
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f8f9fa;
        }
        
        #logo-preview {
            max-width: 100%;
            max-height: 80px;
            object-fit: contain;
        }
        
        /* Slider de Tamanho da Logo */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: var(--wepink-border);
            border-radius: 5px;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
        }
        input[type="range"]:hover { opacity: 1; }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--wepink-pink);
            border-radius: 50%;
            cursor: pointer;
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: var(--wepink-pink);
            border-radius: 50%;
            cursor: pointer;
        }
        
        
        /* Responsividade */
        @media (max-width: 900px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            }
            .admin-container {
                flex-direction: column;
            }
            .nav-link {
                justify-content: center;
            }
            .metrics-grid, .form-grid-2-col, .form-grid-4-col {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    
    <div class="admin-login" id="adminLogin" style="display: none;">
        <h2>Bem-vindo ao Painel Wepink</h2>
        <input type="password" id="adminPassword" placeholder="Insira a senha de administrador">
        <button id="loginButton">Acessar Painel</button>
    </div>

    <div class="admin-container" id="adminPanel" style="display: none;">
        
        <div class="sidebar">
            <div class="sidebar-logo">Wipink ADM</div>
            <a href="#" class="nav-link active" data-section="dashboard">
                <i data-feather="grid"></i> Dashboard
            </a>
            <a href="#" class="nav-link" data-section="products">
                <i data-feather="shopping-bag"></i> Produtos
            </a>
            <a href="#" class="nav-link" data-section="orders">
                <i data-feather="truck"></i> Pedidos
            </a>
            <a href="#" class="nav-link" data-section="customers">
                <i data-feather="users"></i> Clientes
            </a>
            <a href="#" class="nav-link" data-section="settings">
                <i data-feather="settings"></i> Configurações
            </a>
            <a href="#" class="nav-link" id="logoutButton" style="margin-top: auto; color: var(--wepink-text-light);">
                <i data-feather="log-out"></i> Sair
            </a>
        </div>
        
        <div class="main-content">
            
            <div id="dashboard" class="content-section active">
                <h1>Dashboard de Resumo</h1>
                
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div>
                            <div class="label">Vendas Hoje</div>
                            <div class="value">R$ 0,00</div>
                        </div>
                        <i data-feather="trending-up"></i>
                    </div>
                    <div class="metric-card">
                        <div>
                            <div class="label">Total de Produtos</div>
                            <div class="value" id="dashboard-product-count">0</div>
                        </div>
                        <i data-feather="package"></i>
                    </div>
                    <div class="metric-card">
                        <div>
                            <div class="label">Pedidos Pendentes</div>
                            <div class="value">0</div>
                        </div>
                        <i data-feather="alert-triangle"></i>
                    </div>
                    <div class="metric-card">
                        <div>
                            <div class="label">Clientes Novos</div>
                            <div class="value">0</div>
                        </div>
                        <i data-feather="user-plus"></i>
                    </div>
                </div>

                <div class="admin-sections" style="grid-template-columns: 2fr 1fr;">
                    <section class="admin-section">
                        <h2><i data-feather="bar-chart-2"></i> Gráfico de Vendas Semanal</h2>
                        <div style="height: 250px; background-color: var(--wepink-pink-light); border-radius: 8px; text-align: center; line-height: 250px; color: var(--wepink-text-light);">
                            [Área para Gráfico (Ex: Chart.js)]
                        </div>
                    </section>
                    
                    <section class="admin-section">
                        <h2><i data-feather="list"></i> Atividade Recente</h2>
                        <ul style="list-style: none; padding: 0;" id="dashboard-activity">
                            <li style="border-bottom: 1px solid var(--wepink-border); padding: 8px 0; font-size: 14px; color: var(--wepink-text-light);">Nenhuma atividade recente.</li>
                        </ul>
                    </section>
                </div>
            </div>

            <div id="products" class="content-section" style="display: none;">
                <h1>Gerenciamento de Produtos</h1>
                
                <section class="admin-section">
                    <h2><i data-feather="plus-circle"></i> Adicionar/Editar Produto</h2>
                    
                    <div class="form-grid-2-col">
                        <div>
                            <label>Nome do Produto</label>
                            <input type="text" id="product-name" placeholder="Ex: Adesivo Natalino Vermelho">
                            
                            <label>Preço (R$)</label>
                            <input type="text" id="product-price" placeholder="Ex: 5.99">
                            
                            <label>Categoria</label>
                            <select id="product-category">
                                <option value="Adesivos Natalinos">Adesivos Natalinos</option>
                                <option value="Novidades 2025">Novidades 2025</option>
                                <option value="Fitilhos">Fitilhos</option>
                                <option value="Glitter">Glitter</option>
                                <option value="Modelos Exclusivos">Modelos Exclusivos</option>
                                <option value="Adesivos Flores">Adesivos Flores</option>
                                <option value="Adesivos Variados">Adesivos Variados</option>
                                <option value="Coração Estrela e Lua">Coração Estrela e Lua</option>
                                <option value="Raminhos e Folhas">Raminhos e Folhas</option>
                            </select>
                            
                            <label>Descrição Detalhada</label>
                            <textarea id="product-description" rows="4" placeholder="Detalhes do produto..."></textarea>
                        </div>
                        
                        <div>
                            <label for="product-image-name">Nome do Arquivo da Imagem (da pasta /public/img/)</label>
                            <input type="text" id="product-image-name" placeholder="Ex: adesivo-natal-01.png">
                            <p style="font-size: 12px; color: var(--wepink-text-light); margin-top: -10px;">
                                (Certifique-se que o arquivo `.png` está na pasta `public/img` do projeto)
                            </p>

                            <label>Pré-visualização</label>
                            <div class="logo-preview-box" style="height: 150px;">
                                <img id="image-preview" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" 
                                     alt="Pré-visualização da Imagem" 
                                     style="max-width: 100%; max-height: 140px; display: block; margin: 0 auto; border-radius: 4px;">
                            </div>
                        </div>
                    </div>
                    <button class="wepink-btn" id="add-product-btn"><i data-feather="save"></i> Adicionar Produto</button>
                    <button class="wepink-btn" id="cancel-edit-btn" style="background-color: #6c757d; display: none; margin-left: 10px;"><i data-feather="x-circle"></i> Cancelar Edição</button>
                </section>
                
                <section class="admin-section" style="margin-top: 25px;">
                    <h2><i data-feather="database"></i> Tabela de Produtos Cadastrados</h2>
                    <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                        <thead style="background-color: var(--wepink-pink-light);">
                            <tr>
                                <th style="padding: 10px; text-align: left; border: 1px solid var(--wepink-border);">Nome</th>
                                <th style="padding: 10px; text-align: left; border: 1px solid var(--wepink-border);">Preço</th>
                                <th style="padding: 10px; text-align: left; border: 1px solid var(--wepink-border);">Categoria</th>
                                <th style="padding: 10px; text-align: center; border: 1px solid var(--wepink-border);">Ações</th>
                            </tr>
                        </thead>
                        <tbody id="products-table-body">
                            </tbody>
                    </table>
                </section>
            </div>

            <div id="orders" class="content-section" style="display: none;">
                <h1>Gerenciamento de Pedidos</h1>
                <section class="admin-section">
                    <h2><i data-feather="check-square"></i> Pedidos Recentes</h2>
                    <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                        <thead style="background-color: var(--wepink-pink-light);">
                            <tr>
                                <th style="padding: 10px; text-align: left; border: 1px solid var(--wepink-border);">ID</th>
                                <th style="padding: 10px; text-align: left; border: 1px solid var(--wepink-border);">Cliente</th>
                                <th style="padding: 10px; text-align: left; border: 1px solid var(--wepink-border);">Valor</th>
                                <th style="padding: 10px; text-align: left; border: 1px solid var(--wepink-border);">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="4" style="padding: 20px; text-align: center; color: var(--wepink-text-light);">Nenhum pedido encontrado.</td>
                            </tr>
                        </tbody>
                    </table>
                </section>
            </div>
            
            <div id="customers" class="content-section" style="display: none;">
                <h1>Clientes Cadastrados</h1>
                <section class="admin-section">
                    <h2><i data-feather="users"></i> Lista de Clientes</h2>
                    <p style="color: var(--wepink-text-light);">Aqui você gerenciaria a base de clientes, histórico de compras e contatos.</p>
                </section>
            </div>
            
            <div id="settings" class="content-section" style="display: none;">
                <h1>Configurações de Aparência</h1>
                
                <section class="admin-section">
                    <h2><i data-feather="image"></i> Identidade Visual (Logo)</h2>
                    <div class="form-grid-2-col">
                        <div>
                            <label for="setting-logo-upload">Upload da Nova Logo (PNG/JPG)</label>
                            <input type="file" id="setting-logo-upload" accept="image/png, image/jpeg" style="padding: 5px; height: auto;">
                            
                            <label for="setting-logo-size" style="margin-top: 15px;">Tamanho da Logo: <span id="logo-size-value">40 px</span></label>
                            <input type="range" id="setting-logo-size" min="20" max="100" value="40" step="1" style="width: 100%;">
                        </div>
                        <div>
                            <label>Pré-visualização da Logo Atual</label>
                            <div class="logo-preview-box">
                                <img id="logo-preview" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="Pré-visualização da Logo">
                            </div>
                        </div>
                    </div>
                </section>
                
                <section class="admin-section" style="margin-top: 25px;">
                    <h2><i data-feather="droplet"></i> Paleta de Cores</h2>
                    <div class="form-grid-4-col">
                        <div>
                            <label for="setting-color-primary">Cor Principal (Botões)</label>
                            <input type="color" id="setting-color-primary" value="#FF0092">
                        </div>
                         <div>
                            <label for="setting-color-dark">Cor Hover (Escuro)</label>
                            <input type="color" id="setting-color-dark" value="#C90076">
                        </div>
                         <div>
                            <label for="setting-color-bg">Cor de Fundo (Site)</label>
                            <input type="color" id="setting-color-bg" value="#FFFFFF">
                        </div>
                         <div>
                            <label for="setting-color-text">Cor do Texto (Principal)</label>
                            <input type="color" id="setting-color-text" value="#222222">
                        </div>
                    </div>
                </section>
                
                <section class="admin-section" style="margin-top: 25px;">
                    <h2><i data-feather="type"></i> Tipografia e Estilo</h2>
                     <div class="form-grid-2-col">
                        <div>
                            <label for="setting-font">Fonte Principal do Site</label>
                            <select id="setting-font">
                                <option value="system">Padrão do Sistema</option>
                                <option value="roboto">Roboto</option>
                                <option value="montserrat">Montserrat</option>
                                <option value="opensans">Open Sans</option>
                            </select>
                        </div>
                        <div>
                            <label>Estilo dos Cards de Produto</label>
                            <div class="radio-group">
                                <label>
                                    <input type="radio" name="cardStyle" value="shadow" checked> Sombra (Padrão)
                                </label>
                                 <label>
                                    <input type="radio" name="cardStyle" value="flat"> Borda Plana (Flat)
                                </label>
                            </div>
                        </div>
                     </div>
                </section>
                
                <button class="wepink-btn" id="save-settings-btn" style="margin-top: 25px;"><i data-feather="save"></i> Salvar Aparência</button>
            </div>
        </div>
    </div>
    
    <script>
        // Inicializa os ícones Feather
        feather.replace();

        // --- VARIÁVEIS DO DOM ---
        const adminPanel = document.getElementById('adminPanel');
        const adminLogin = document.getElementById('adminLogin');
        const loginButton = document.getElementById('loginButton');
        const logoutButton = document.getElementById('logoutButton');
        const navLinks = document.querySelectorAll('.nav-link[data-section]');
        const contentSections = document.querySelectorAll('.content-section');

        // Variáveis do formulário de Produto
        const imageNameInput = document.getElementById('product-image-name'); // MUDANÇA: Campo de texto
        const imagePreview = document.getElementById('image-preview');
        const addProductBtn = document.getElementById('add-product-btn');
        const cancelEditBtn = document.getElementById('cancel-edit-btn');
        const productsTableBody = document.getElementById('products-table-body');
        const productCategorySelect = document.getElementById('product-category'); 

        // Variáveis do Dashboard
        const productCountEl = document.getElementById('dashboard-product-count');
        const activityListEl = document.getElementById('dashboard-activity');

        // Variáveis de Configurações
        const saveSettingsBtn = document.getElementById('save-settings-btn');
        const colorPrimaryInput = document.getElementById('setting-color-primary');
        const colorDarkInput = document.getElementById('setting-color-dark');
        const colorBgInput = document.getElementById('setting-color-bg');
        const colorTextInput = document.getElementById('setting-color-text');
        const fontSelect = document.getElementById('setting-font');
        const logoUploadInput = document.getElementById('setting-logo-upload'); 
        const logoPreview = document.getElementById('logo-preview'); 
        const logoSizeSlider = document.getElementById('setting-logo-size'); 
        const logoSizeValue = document.getElementById('logo-size-value'); 

        // Variáveis de Controle de Estado
        let currentEditingId = null; 

        // --- CONSTANTES ---
        const ADMIN_PASSWORD = 'wepink123'; 

        function loginAdmin(password) {
            return password === ADMIN_PASSWORD;
        }

        function showPanel() {
            adminLogin.style.display = 'none';
            adminPanel.style.display = 'flex';
            localStorage.setItem('adminLoggedIn', 'true');
            loadProductsToAdminTable(); 
            updateDashboard();
            loadSettingsToForm();
        }

        function showLogin() {
            adminLogin.style.display = 'none';
            adminLogin.style.display = 'flex';
            localStorage.removeItem('adminLoggedIn');
        }

        // --- FUNÇÕES DE PRODUTO (LOCAL STORAGE) ---

        function getProducts() {
            const productsJSON = localStorage.getItem('wipinkProducts');
            return productsJSON ? JSON.parse(productsJSON) : [];
        }

        function saveProducts(products) {
            // Verifica o limite antes de salvar
            try {
                localStorage.setItem('wipinkProducts', JSON.stringify(products));
            } catch (e) {
                // Se der erro (provavelmente "Quota exceeded" - Limite estourado)
                alert("Erro: Limite de armazenamento atingido (cerca de 33 produtos)! Não é possível salvar mais itens.");
                // Remove o último item adicionado para não corromper os dados
                products.pop();
                localStorage.setItem('wipinkProducts', JSON.stringify(products));
            }
        }

        // --- FUNÇÕES DE CONFIGURAÇÃO (LOCAL STORAGE) ---
        function getSettings() {
            const settingsJSON = localStorage.getItem('wipinkSettings');
            return settingsJSON ? JSON.parse(settingsJSON) : {};
        }

        function saveSettings(settings) {
            localStorage.setItem('wipinkSettings', JSON.stringify(settings));
            applySettingsToDOM(settings);
        }

        function loadSettingsToForm() {
            const settings = getSettings();
            colorPrimaryInput.value = settings.primaryColor || '#FF0092';
            colorDarkInput.value = settings.darkColor || '#C90076';
            colorBgInput.value = settings.bgColor || '#FFFFFF';
            colorTextInput.value = settings.textColor || '#222222';
            fontSelect.value = settings.font || 'system';
            const cardStyle = settings.cardStyle || 'shadow';
            document.querySelector(`input[name="cardStyle"][value="${cardStyle}"]`).checked = true;
            if (settings.logoUrl) logoPreview.src = settings.logoUrl;
            else logoPreview.src = "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";
            const size = settings.logoSize || '40';
            logoSizeSlider.value = size;
            logoSizeValue.textContent = `${size} px`;
        }

        function applySettingsToDOM(settings) {
            const root = document.documentElement;
            if (settings.primaryColor) root.style.setProperty('--wepink-pink', settings.primaryColor);
            if (settings.darkColor) root.style.setProperty('--wepink-pink-dark', settings.darkColor);
            if (settings.bgColor) root.style.setProperty('--wepink-bg', settings.bgColor);
            if (settings.textColor) root.style.setProperty('--wepink-text', settings.textColor);
            let fontFamily = '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif';
            if (settings.font === 'roboto') fontFamily = "'Roboto', sans-serif";
            else if (settings.font === 'montserrat') fontFamily = "'Montserrat', sans-serif";
            else if (settings.font === 'opensans') fontFamily = "'Open Sans', sans-serif";
            root.style.setProperty('--wepink-font-family', fontFamily);
        }

        // --- FUNÇÕES DE ATUALIZAÇÃO (DASHBOARD, TABELA) ---

        function updateDashboard() {
            const products = getProducts();
            productCountEl.textContent = products.length;

            if (products.length > 0) {
                activityListEl.innerHTML = '';
                products.slice(-3).reverse().forEach(product => {
                    activityListEl.innerHTML += `<li style="border-bottom: 1px solid var(--wepink-border); padding: 8px 0; font-size: 14px;">Produto: ${product.name}</li>`;
                });
            } else {
                activityListEl.innerHTML = `<li style="border-bottom: 1px solid var(--wepink-border); padding: 8px 0; font-size: 14px; color: var(--wepink-text-light);">Nenhuma atividade recente.</li>`;
            }
        }

        function loadProductsToAdminTable() {
            productsTableBody.innerHTML = ''; 
            
            const products = getProducts();
            
            if (products.length === 0) {
                productsTableBody.innerHTML = `<tr><td colspan="4" style="text-align: center; color: var(--wepink-text-light); padding: 20px;">Nenhum produto cadastrado.</td></tr>`;
                return;
            }

            products.forEach(product => {
                const newRow = productsTableBody.insertRow();
                newRow.setAttribute('data-id', product.id); 
                
                newRow.innerHTML = `
                    <td style="padding: 10px; border: 1px solid var(--wepink-border);">${product.name}</td>
                    <td style="padding: 10px; border: 1px solid var(--wepink-border);">R$ ${product.price}</td>
                    <td style="padding: 10px; border: 1px solid var(--wepink-border);">${product.category}</td>
                    <td style="padding: 10px; text-align: center; border: 1px solid var(--wepink-border);">
                        <button class="wepink-btn edit-btn" data-id="${product.id}" style="padding: 5px 10px; font-size: 12px; margin: 0 5px; background-color: #6c757d;">
                            <i data-feather="edit-2" style="width: 14px; height: 14px; margin-right: 3px;"></i> Editar
                        </button>
                        <button class="wepink-btn delete-btn" data-id="${product.id}" style="padding: 5px 10px; font-size: 12px; margin: 0; background-color: #dc3545;">
                            <i data-feather="trash-2" style="width: 14px; height: 14px; margin-right: 3px;"></i> Deletar
                        </button>
                    </td>
                `;
            });
            
            feather.replace(); 

            document.querySelectorAll('.edit-btn').forEach(button => {
                button.addEventListener('click', handleEditProduct);
            });
            document.querySelectorAll('.delete-btn').forEach(button => {
                button.addEventListener('click', handleDeleteProduct);
            });
        }

        // --- FUNÇÕES CRUD (LOCAL STORAGE) ---

        function handleDeleteProduct(e) {
            const idToDelete = parseInt(e.currentTarget.dataset.id, 10); 
            if (!confirm('Tem certeza que deseja deletar este produto?')) {
                return;
            }

            let products = getProducts();
            products = products.filter(product => product.id !== idToDelete);
            
            saveProducts(products); // Salva no localStorage
            loadProductsToAdminTable(); 
            updateDashboard(); 
            
            if (currentEditingId === idToDelete) {
                resetForm();
            }
            alert('Produto deletado com sucesso!');
        }

        function handleEditProduct(e) {
            const idToEdit = parseInt(e.currentTarget.dataset.id, 10); 
            const products = getProducts();
            const product = products.find(p => p.id === idToEdit); 

            if (!product) {
                alert('Erro: Produto não encontrado!'); 
                resetForm(); 
                return;
            }

            document.getElementById('product-name').value = product.name;
            document.getElementById('product-price').value = product.price;
            productCategorySelect.value = product.category; 
            document.getElementById('product-description').value = product.description;
            
            // MUDANÇA: Preenche o campo de NOME do arquivo
            imageNameInput.value = product.imageName || ''; 
            updateImagePreview();
            
            addProductBtn.innerHTML = '<i data-feather="refresh-cw" style="width: 18px; height: 18px; margin-right: 5px;"></i> Salvar Edição';
            addProductBtn.style.backgroundColor = 'var(--wepink-pink-dark)'; 
            cancelEditBtn.style.display = 'inline-flex';
            
            currentEditingId = idToEdit;
            feather.replace(); 
            
            document.querySelector('.nav-link[data-section="products"]').click();
            document.querySelector('.content-section#products').style.display = 'block'; 
        }

        // MUDANÇA: Esta função agora salva o NOME DO ARQUIVO (leve)
        function saveOrUpdateProduct() {
            const name = document.getElementById('product-name').value;
            const price = document.getElementById('product-price').value;
            const category = productCategorySelect.value;
            const description = document.getElementById('product-description').value;
            const imageName = imageNameInput.value; // Pega o nome do arquivo

            if (!name || !price || !imageName) {
                alert('Por favor, preencha o Nome, Preço e o Nome do Arquivo da Imagem!');
                return;
            }
            
            addProductBtn.disabled = true;
            addProductBtn.innerHTML = '<i data-feather="loader" class="feather-spin"></i> Salvando...';
            feather.replace();

            let products = getProducts();
            
            // Constrói o URL da imagem (presume que está em /img/ ou /public/img/)
            // NOTA: Como estamos 100% local, o navegador não pode acessar /img/
            // Vamos salvar a Base64 do upload de arquivo (revertendo a ideia do nome do arquivo)
            
            // A LÓGICA CORRETA PARA 100% LOCAL (UPLOAD DE ARQUIVO)
            const imageFile = document.getElementById('product-image-upload')?.files[0]; // Recupera o input de arquivo
            
             // Processa a imagem (converte para Data URL)
            const processLocalImage = (file) => {
                return new Promise((resolve) => {
                    if (!file) {
                        resolve(null);
                        return;
                    }
                    const reader = new FileReader();
                    reader.onload = (e) => resolve(e.target.result); // O resultado é a Base64
                    reader.readAsDataURL(file);
                });
            };

            processLocalImage(imageFile).then(base64ImageUrl => {
                let products = getProducts();
                
                const productData = {
                    name: name,
                    price: price,
                    category: category,
                    description: description,
                    image: base64ImageUrl // Esta será a Base64 ou null
                };

                if (currentEditingId !== null) {
                    // --- EDIÇÃO ---
                    const productIndex = products.findIndex(p => p.id === currentEditingId);
                    if (productIndex === -1) {
                         resetForm();
                         return;
                    }
                    
                    // Se nenhuma imagem nova foi enviada, mantém a antiga
                    if (!base64ImageUrl) {
                        productData.image = products[productIndex].image;
                    }

                    products[productIndex] = { ...products[productIndex], ...productData, id: currentEditingId };
                    alert(`Produto "${name}" editado com sucesso!`);
                } else {
                    // --- NOVA ADIÇÃO ---
                    if (!base64ImageUrl) {
                        alert('Por favor, selecione a Imagem para um novo produto!');
                        resetForm();
                        return;
                    }
                    
                    const newId = products.length > 0 ? Math.max(...products.map(p => Number(p.id) || 0)) + 1 : 1;
                    productData.id = newId;
                    products.push(productData);
                    alert(`Produto "${name}" adicionado com sucesso!`);
                }
                
                saveProducts(products); // Salva no localStorage
                loadProductsToAdminTable(); 
                updateDashboard(); 
                
                // Adicionado um pequeno delay para o usuário ver o "Salvando"
                setTimeout(resetForm, 300);
            });
        }


        // Função para limpar o formulário e resetar o botão "Adicionar"
        function resetForm() {
            document.getElementById('product-name').value = '';
            document.getElementById('product-price').value = '';
            document.getElementById('product-description').value = '';
            productCategorySelect.value = 'Adesivos Natalinos'; 
            document.getElementById('product-image-upload').value = ''; // Limpa o input de arquivo
            
            updateImagePreview(); // Reseta a pré-visualização
            
            addProductBtn.innerHTML = '<i data-feather="save" style="width: 18px; height: 18px; margin-right: 5px;"></i> Adicionar Produto';
            addProductBtn.style.backgroundColor = 'var(--wepink-pink)';
            addProductBtn.disabled = false;
            cancelEditBtn.style.display = 'none'; 
            
            currentEditingId = null; 
            feather.replace();
        }
        
        // MUDANÇA: Atualiza a pré-visualização da imagem
        function updateImagePreview(file) {
             if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    imagePreview.src = e.target.result;
                    previewText.textContent = file.name;
                };
                reader.readAsDataURL(file);
            } else {
                 imagePreview.src = "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";
                 previewText.textContent = "Pré-visualização da imagem (máx. 150px)";
            }
        }

        // --- EVENT LISTENERS GERAIS ---
        document.addEventListener('DOMContentLoaded', function() {
            
            if (localStorage.getItem('adminLoggedIn') === 'true') {
                showPanel();
            } else {
                showLogin();
            }
            
            loginButton.addEventListener('click', function() {
                const password = document.getElementById('adminPassword').value;
                if (loginAdmin(password)) {
                    showPanel();
                } else {
                    alert('Senha incorreta!');
                    document.getElementById('adminPassword').value = ''; 
                }
            });
            
            logoutButton.addEventListener('click', function(e) {
                e.preventDefault();
                showLogin();
                resetForm(); 
            });
            
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('data-section');
                    
                    navLinks.forEach(l => l.classList.remove('active'));
                    contentSections.forEach(s => s.style.display = 'none');
                    
                    this.classList.add('active');
                    
                    const targetSection = document.getElementById(targetId);
                    if (targetSection) {
                        targetSection.style.display = 'block';
                    }
                    
                    if (targetId === 'products') {
                        resetForm();
                    }
                    if (targetId === 'dashboard') {
                        updateDashboard();
                    }
                    if (targetId === 'settings') {
                        loadSettingsToForm();
                    }
                });
            });
            
            document.querySelector('.nav-link[data-section="dashboard"]').click();
            
            // --- LÓGICA DE PRODUTO ---
            if (imageUploadInput) {
                // Pré-visualização do upload de arquivo
                imageUploadInput.addEventListener('change', function() {
                    const file = this.files[0];
                    updateImagePreview(file);
                });
            }

            if (addProductBtn) {
                addProductBtn.addEventListener('click', saveOrUpdateProduct);
            }
            
            if (cancelEditBtn) {
                cancelEditBtn.addEventListener('click', resetForm);
            }
            
            // --- LÓGICA DE CONFIGURAÇÕES ---
            if (logoUploadInput) {
                logoUploadInput.addEventListener('change', function() {
                    const file = this.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            logoPreview.src = e.target.result;
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
            
            if (logoSizeSlider) {
                logoSizeSlider.addEventListener('input', function() {
                    const size = this.value;
                    logoSizeValue.textContent = `${size} px`;
                    logoPreview.style.height = `${size}px`;
                });
            }

            if (saveSettingsBtn) {
                saveSettingsBtn.addEventListener('click', function() {
                    
                    const settings = {
                        primaryColor: colorPrimaryInput.value,
                        darkColor: colorDarkInput.value,
                        bgColor: colorBgInput.value,
                        textColor: colorTextInput.value,
                        font: fontSelect.value,
                        cardStyle: document.querySelector('input[name="cardStyle"]:checked').value,
                        logoUrl: getSettings().logoUrl, 
                        logoSize: logoSizeSlider.value 
                    };
                    
                    const logoFile = logoUploadInput.files[0];

                    if (logoFile) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            settings.logoUrl = e.target.result;
                            saveSettings(settings);
                            logoUploadInput.value = '';
                            alert('Aparência e nova logo salvas! O site e o painel foram atualizados.');
                        };
                        reader.readAsDataURL(file);
                    } else {
                        saveSettings(settings);
                        alert('Aparência salva! O site e o painel foram atualizados.');
                    }
                });
            }
        });

        // Adiciona classe de 'girar' para o ícone de 'loader'
        const styleSheet = document.createElement("style");
        styleSheet.type = "text/css";
        styleSheet.innerText = `
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
            .feather-spin {
                animation: spin 1s linear infinite;
            }
        `;
        document.head.appendChild(styleSheet);
    </script>
    
    <script src="https://huggingface.co/deepsite/deepsite-badge.js"></script>
</body>
</html>
