<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PinkDetalhe - Adesivos que encantam</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        pink: {
                            50: '#fdf2f8',
                            100: '#fce7f3',
                            200: '#fbcfe8',
                            300: '#f9a8d4',
                            400: '#f472b6',
                            500: '#ec4899',
                            600: '#db2777',
                            700: '#be185d',
                            800: '#9d174d',
                            900: '#831843',
                        }
                    }
                }
            }
        }
    </script>

    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* Estilos globais simples */
        body {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
        }
        /* Efeito de anima√ß√£o de hover no bot√£o */
        .cta-button:hover .ph-sparkle {
            transform: scale(1.1) rotate(15deg);
        }
        /* Estilo para a Tab ativa no Admin Modal */
        .tab-active {
            background-color: #db2777 !important; /* pink-600 */
            color: white !important;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gradient-to-b from-pink-50 via-white to-pink-50 min-h-screen">

    <div id="app" class="relative">
        
        <header class="fixed top-0 left-0 right-0 z-40 bg-white/80 backdrop-blur-md border-b border-pink-100">
            <div class="container mx-auto px-4 py-4 flex justify-between items-center">
                <div class="flex items-center gap-2 cursor-pointer" onclick="navigate('home')">
                    <div class="w-10 h-10 bg-gradient-to-br from-pink-500 to-pink-600 rounded-2xl flex items-center justify-center rotate-12">
                        <i class="ph-fill ph-heart text-white text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold bg-gradient-to-r from-pink-600 to-pink-500 bg-clip-text text-transparent">
                            PinkDetalhe
                        </h1>
                        <p class="text-xs text-pink-600">Adesivos que encantam ‚ú®</p>
                    </div>
                </div>

                <div class="flex items-center gap-3">
                    <button id="auth-button" onclick="handleAuthClick()" class="flex items-center gap-1 px-3 py-2 text-sm text-pink-600 hover:bg-pink-50 rounded-lg transition border border-pink-200">
                        <i class="ph ph-user text-lg"></i>
                        <span>Entrar</span>
                    </button>
                    
                    <button onclick="toggleCart(true)" class="relative bg-gradient-to-r from-pink-500 to-pink-600 hover:from-pink-600 hover:to-pink-700 text-white p-2 rounded-lg transition shadow-sm">
                        <i class="ph ph-shopping-cart text-xl"></i>
                        <span id="cart-badge" class="absolute -top-2 -right-2 bg-pink-700 text-white text-xs font-bold w-5 h-5 flex items-center justify-center rounded-full border-2 border-white hidden">
                            0
                        </span>
                    </button>
                </div>
            </div>
        </header>

        <main id="main-content" class="pt-24 pb-12 min-h-[80vh]">
            </main>

        <footer class="bg-gradient-to-r from-pink-500 to-pink-600 text-white py-12">
            <div class="container mx-auto px-4 text-center">
                <div class="flex justify-center items-center gap-2 mb-4">
                    <i class="ph-fill ph-heart text-2xl"></i>
                    <h3 class="text-2xl font-bold">PinkDetalhe</h3>
                </div>
                <p class="text-pink-100 mb-2">Adesivos artesanais com muito carinho üíï</p>
                <p class="text-sm text-pink-200">Pedido m√≠nimo: R$ 19,90</p>
            </div>
        </footer>

        <div id="overlay" class="fixed inset-0 bg-black/30 backdrop-blur-sm z-50 hidden" onclick="closeAllModals()"></div>

        <div id="cart-sidebar" class="fixed top-0 right-0 bottom-0 w-full md:w-[450px] bg-white shadow-2xl z-50 translate-x-full transition-transform duration-300 ease-in-out flex flex-col">
            <div class="p-6 border-b border-pink-100 bg-gradient-to-r from-pink-50 to-white flex justify-between items-center">
                <h2 class="text-2xl font-bold text-gray-900">Seu Carrinho</h2>
                <button onclick="toggleCart(false)" class="p-2 hover:bg-pink-100 rounded-full text-gray-500 transition">
                    <i class="ph ph-x text-xl"></i>
                </button>
            </div>
            <div id="cart-items" class="flex-1 overflow-y-auto p-6 space-y-4">
                </div>
            <div id="cart-footer" class="p-6 border-t border-pink-100 bg-gray-50">
                </div>
        </div>

        <div id="checkout-modal" class="fixed inset-0 z-[60] flex items-center justify-center p-4 hidden pointer-events-none">
             <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full mx-auto scale-95 opacity-0 transition-all duration-300 pointer-events-auto" id="checkout-modal-content">
                </div>
        </div>
        
        <div id="login-modal" class="fixed inset-0 z-[60] flex items-center justify-center p-4 hidden pointer-events-none">
             <div class="bg-white rounded-2xl shadow-2xl max-w-sm w-full mx-auto p-6 scale-95 opacity-0 transition-all duration-300 pointer-events-auto" id="login-modal-content">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">Acesso CEO</h2>
                    <button onclick="toggleLogin(false)" class="text-gray-400 hover:text-gray-600">
                        <i class="ph ph-x text-xl"></i>
                    </button>
                </div>
                <form onsubmit="handleLoginSubmit(event)" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Usu√°rio</label>
                        <input type="text" id="admin-user" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500 outline-none" placeholder="bruno3691">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Senha</label>
                        <input type="password" id="admin-password" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500 outline-none" placeholder="******">
                    </div>
                    <p id="login-error" class="text-red-500 text-sm hidden">Usu√°rio ou senha inv√°lidos.</p>
                    <button type="submit" class="w-full bg-pink-600 hover:bg-pink-700 text-white py-3 rounded-xl font-bold text-lg transition flex items-center justify-center gap-2">
                        <i class="ph ph-sign-in text-2xl"></i>
                        Entrar
                    </button>
                </form>
             </div>
        </div>

        <div id="admin-modal" class="fixed inset-0 z-[60] flex items-center justify-center p-4 hidden pointer-events-none">
             <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto mx-auto scale-95 opacity-0 transition-all duration-300 pointer-events-auto" id="admin-modal-content">
                <div class="p-6 border-b border-pink-100 sticky top-0 bg-white z-10">
                    <div class="flex justify-between items-center">
                        <h2 class="text-2xl font-bold text-gray-900 flex items-center gap-2">
                            <i class="ph ph-crown-simple text-pink-600"></i> Gerenciar Loja (CEO)
                        </h2>
                        <button onclick="toggleAdmin(false)" class="p-2 hover:bg-pink-100 rounded-full text-gray-500 transition">
                            <i class="ph ph-x text-xl"></i>
                        </button>
                    </div>
                </div>

                <div id="admin-tabs-list" class="w-full flex justify-center p-4 sticky top-[77px] bg-white z-10 border-b border-gray-100">
                    <button onclick="setActiveAdminTab('add')" id="tab-add" class="tab-active px-4 py-2 font-medium text-sm rounded-l-xl transition hover:bg-pink-50/50">Adicionar Novo</button>
                    <button onclick="setActiveAdminTab('manage')" id="tab-manage" class="px-4 py-2 font-medium text-sm transition hover:bg-pink-50/50 border-x border-gray-200">Gerenciar (<span id="product-count">0</span>)</button>
                    <button onclick="setActiveAdminTab('settings')" id="tab-settings" class="px-4 py-2 font-medium text-sm rounded-r-xl transition hover:bg-pink-50/50">Configura√ß√µes</button>
                </div>

                <div id="admin-content" class="px-6 pb-6">
                    </div>
             </div>
        </div>

    </div>

    
        function saveState() {
            localStorage.setItem('cart', JSON.stringify(state.cart));
            localStorage.setItem('products', JSON.stringify(state.products));
            localStorage.setItem('orders', JSON.stringify(state.orders));
            localStorage.setItem('settings', JSON.stringify(state.settings));
            localStorage.setItem('isLoggedIn', state.isLoggedIn);
        }

        // --- FUN√á√ïES DE AUTENTICA√á√ÉO ---
        function updateAuthButton() {
            const button = document.getElementById('auth-button');
            if (!button) return;

            if (state.isLoggedIn) {
                button.innerHTML = '<i class="ph ph-crown-simple text-lg"></i><span>Gerenciar</span>';
                button.onclick = () => toggleAdmin(true);
                button.classList.remove('border-pink-200');
                button.classList.add('bg-pink-600', 'text-white', 'hover:bg-pink-700');
            } else {
                button.innerHTML = '<i class="ph ph-sign-in text-lg"></i><span>Entrar</span>';
                button.onclick = () => toggleLogin(true);
                button.classList.add('border-pink-200');
                button.classList.remove('bg-pink-600', 'text-white', 'hover:bg-pink-700');
            }
        }
        
        function handleAuthClick() {
            if (state.isLoggedIn) {
                toggleAdmin(true);
            } else {
                toggleLogin(true);
            }
        }
        
        function handleLoginSubmit(e) {
            e.preventDefault();
            const user = document.getElementById('admin-user').value;
            const pass = document.getElementById('admin-password').value;
            const errorElement = document.getElementById('login-error');

            if (user === ADMIN_USER && pass === ADMIN_PASS) {
                state.isLoggedIn = true;
                saveState();
                updateAuthButton();
                toggleLogin(false);
                toggleAdmin(true); // Abre o painel de administra√ß√£o
            } else {
                errorElement.classList.remove('hidden');
            }
        }
        
        function handleLogout() {
            state.isLoggedIn = false;
            saveState();
            updateAuthButton();
            closeAllModals();
        }

        // --- FUN√á√ïES DE NAVEGA√á√ÉO E RENDERIZA√á√ÉO ---
        function navigate(view) {
            const main = document.getElementById('main-content');
            window.scrollTo(0, 0);
            
            if (view === 'home') {
                renderHome(main);
            } else if (view === 'orders') {
                renderOrders(main);
            }
            closeAllModals();
        }

        // RENDERIZA√á√ÉO DA P√ÅGINA INICIAL
        function renderHome(container) {
            const kit = state.products.find(p => p.id === 1) || state.products[0];
            const productImage = kit.image_url;
            const images = [kit.image_url, ...(kit.image_urls || [])].filter(Boolean);

            container.innerHTML = `
                <div class="container mx-auto px-4 py-12 mb-12 text-center">
                    <div class="inline-flex items-center gap-2 px-4 py-2 bg-pink-100 rounded-full mb-6">
                        <i class="ph-fill ph-sparkle text-pink-600"></i>
                        <span class="text-sm font-medium text-pink-600">Kit Completo</span>
                    </div>
                    <h2 class="text-4xl md:text-6xl font-bold mb-6 bg-gradient-to-r from-pink-600 via-pink-500 to-pink-600 bg-clip-text text-transparent leading-tight max-w-4xl mx-auto">
                        Porque seu estilo merece estar em todos os detalhes
                    </h2>
                    <p class="text-lg text-gray-600 mb-8 max-w-2xl mx-auto">
                        Kit completo com adesivos exclusivos, glitter e fitilhos por apenas <span class="font-bold text-pink-600">R$ ${kit.price.toFixed(2).replace('.', ',')}</span>
                    </p>

                    <div class="flex flex-wrap justify-center gap-6 mb-8">
                        <div class="flex items-center gap-2 px-4 py-2 bg-white rounded-xl shadow-sm border border-pink-100">
                            <i class="ph-fill ph-heart text-pink-500"></i>
                            <span class="text-sm text-gray-700">Adesivos exclusivos</span>
                        </div>
                        <div class="flex items-center gap-2 px-4 py-2 bg-white rounded-xl shadow-sm border border-pink-100">
                            <i class="ph-fill ph-star text-pink-500"></i>
                            <span class="text-sm text-gray-700">Glitter</span>
                        </div>
                        <div class="flex items-center gap-2 px-4 py-2 bg-white rounded-xl shadow-sm border border-pink-100">
                            <i class="ph ph-sparkle text-pink-500"></i>
                            <span class="text-sm text-gray-700">Fitilhos</span>
                        </div>
                    </div>

                    <div class="inline-block px-6 py-3 bg-gradient-to-r from-pink-100 to-pink-50 rounded-2xl border border-pink-200">
                        <p class="text-sm text-pink-700">Pedido m√≠nimo: R$ ${state.settings.min_order_value.toFixed(2).replace('.', ',')}</p>
                    </div>
                </div>

                <div class="container mx-auto px-4 py-12">
                    <div class="max-w-5xl mx-auto">
                        <div class="grid md:grid-cols-2 gap-8 md:gap-12 items-center">
                            <div class="order-2 md:order-1">
                                ${images.length > 1 ? renderProductCarouselHTML(kit.id, images) : `
                                    <div class="aspect-square overflow-hidden bg-gradient-to-br from-pink-50 to-white rounded-2xl shadow-xl">
                                        <img src="${productImage}" alt="${kit.name}" class="w-full h-full object-cover">
                                    </div>
                                `}

                                <div class="grid grid-cols-3 gap-4 pt-4 border-t border-pink-200 mt-8">
                                    <div class="text-center">
                                        <div class="text-2xl mb-1">‚ú®</div>
                                        <p class="text-xs text-gray-600">Adesivos Exclusivos</p>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-2xl mb-1">üíñ</div>
                                        <p class="text-xs text-gray-600">Glitter</p>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-2xl mb-1">üéÄ</div>
                                        <p class="text-xs text-gray-600">Fitilhos</p>
                                    </div>
                                </div>
                            </div>

                            <div class="order-1 md:order-2 space-y-6">
                                <span class="text-sm font-semibold text-pink-600 border border-pink-300 px-3 py-1 rounded-full">${kit.category}</span>
                                
                                <h2 class="text-4xl font-bold text-gray-900 leading-snug">
                                    ${kit.name}
                                </h2>

                                <div class="text-lg text-gray-700 leading-relaxed space-y-4">
                                    <p class="font-bold text-pink-800">üíñ KIT PINKDETALHE ‚Äì Detalhes que encantam</p>
                                    <p>${kit.description}</p>
                                </div>
                                
                                <div class="bg-gradient-to-br from-pink-50 to-pink-100 rounded-2xl p-6 border-2 border-pink-200">
                                    <div class="flex items-baseline gap-2 mb-2">
                                        <span class="text-gray-600">Por apenas</span>
                                        <span class="text-5xl font-bold text-pink-600">
                                            R$ ${kit.price.toFixed(2).replace('.', ',')}
                                        </span>
                                    </div>
                                    <p class="text-sm text-pink-700">
                                        ‚ú® Tudo que voc√™ precisa em um √∫nico kit
                                    </p>
                                </div>

                                <button
                                    onclick="addToCart(${kit.id})"
                                    ${!kit.in_stock ? 'disabled' : ''}
                                    class="w-full bg-gradient-to-r from-pink-500 to-pink-600 hover:from-pink-600 hover:to-pink-700 text-white py-4 rounded-xl font-bold text-lg shadow-lg transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 cta-button">
                                    <i class="ph-fill ph-sparkle text-white text-xl transition-transform duration-300"></i>
                                    ${kit.in_stock ? "Adicionar ao Carrinho" : "Esgotado"}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            // Inicializa o carrossel se houver m√∫ltiplas imagens
            if (images.length > 1) {
                setTimeout(() => initProductCarousel(kit.id, images), 10);
            }
        }
        
        // Fun√ß√£o para gerar o HTML do carrossel (sem JS de l√≥gica)
        function renderProductCarouselHTML(productId, images) {
            return `
                <div id="carousel-container-${productId}" class="relative group">
                    <div id="carousel-track-${productId}" class="aspect-square overflow-hidden bg-gradient-to-br from-pink-50 to-white rounded-2xl relative">
                        </div>
                    
                    <button id="carousel-prev-${productId}" class="absolute left-2 top-1/2 -translate-y-1/2 p-3 bg-white/90 hover:bg-white text-gray-700 rounded-full shadow-lg transition-opacity opacity-0 group-hover:opacity-100">
                        <i class="ph ph-chevron-left text-xl"></i>
                    </button>
                    <button id="carousel-next-${productId}" class="absolute right-2 top-1/2 -translate-y-1/2 p-3 bg-white/90 hover:bg-white text-gray-700 rounded-full shadow-lg transition-opacity opacity-0 group-hover:opacity-100">
                        <i class="ph ph-chevron-right text-xl"></i>
                    </button>

                    <div id="carousel-dots-${productId}" class="absolute bottom-4 left-0 right-0 flex justify-center gap-2">
                        </div>
                </div>
            `;
        }

        // L√≥gica de controle do carrossel (JS)
        function initProductCarousel(productId, images) {
            let currentIndex = 0;
            const track = document.getElementById(`carousel-track-${productId}`);
            const prevButton = document.getElementById(`carousel-prev-${productId}`);
            const nextButton = document.getElementById(`carousel-next-${productId}`);
            const dotsContainer = document.getElementById(`carousel-dots-${productId}`);
            const AUTOPLAY_INTERVAL = 3000; // 3 segundos

            if (!track) return; 

            // 1. Renderiza as imagens
            track.innerHTML = images.map((src, index) => `
                <img src="${src}" alt="Imagem ${index + 1}" class="absolute top-0 left-0 w-full h-full object-cover transition-opacity duration-300" 
                    style="opacity: ${index === currentIndex ? 1 : 0};">
            `).join('');
            const carouselImages = track.querySelectorAll('img');

            // 2. Renderiza os dots
            dotsContainer.innerHTML = images.map((_, index) => `
                <button onclick="goToSlide(${productId}, ${index}, ${images.length})" 
                        class="w-2 h-2 rounded-full transition-all duration-300 ${index === currentIndex ? 'bg-pink-600 w-6' : 'bg-white/60 hover:bg-white/80'}">
                </button>
            `).join('');
            const dots = dotsContainer.querySelectorAll('button');

            // Fun√ß√£o para mudar o slide
            window.goToSlide = (id, newIndex, total) => {
                if (id !== productId) return; 
                if (newIndex < 0 || newIndex >= total) return;
                
                // Desativa o slide atual
                carouselImages[currentIndex].style.opacity = 0;
                dots[currentIndex].classList.remove('bg-pink-600', 'w-6');
                dots[currentIndex].classList.add('bg-white/60');
                
                currentIndex = newIndex;
                
                // Ativa o novo slide
                carouselImages[currentIndex].style.opacity = 1;
                dots[currentIndex].classList.add('bg-pink-600', 'w-6');
                dots[currentIndex].classList.remove('bg-white/60');
            };

            // 3. L√≥gica do Autoplay
            let autoplayTimer = setInterval(() => {
                const newIndex = currentIndex === images.length - 1 ? 0 : currentIndex + 1;
                goToSlide(productId, newIndex, images.length);
            }, AUTOPLAY_INTERVAL);

            // 4. Eventos de navega√ß√£o (pausam o autoplay ao interagir)
            const pauseAutoplay = () => {
                clearInterval(autoplayTimer);
                autoplayTimer = setInterval(() => {
                    const newIndex = currentIndex === images.length - 1 ? 0 : currentIndex + 1;
                    goToSlide(productId, newIndex, images.length);
                }, AUTOPLAY_INTERVAL);
            };

            prevButton.onclick = () => {
                const newIndex = currentIndex === 0 ? images.length - 1 : currentIndex - 1;
                goToSlide(productId, newIndex, images.length);
                pauseAutoplay();
            };

            nextButton.onclick = () => {
                const newIndex = currentIndex === images.length - 1 ? 0 : currentIndex + 1;
                goToSlide(productId, newIndex, images.length);
                pauseAutoplay();
            };
            
            dotsContainer.querySelectorAll('button').forEach(button => {
                button.addEventListener('click', pauseAutoplay);
            });
        }


        // RENDERIZA√á√ÉO DA P√ÅGINA DE PEDIDOS
        function renderOrders(container) {
            const isAdmin = state.isLoggedIn;
            const ordersToDisplay = state.orders.slice().reverse(); // Mostra todos os pedidos, do mais recente ao mais antigo.

            const ordersHTML = ordersToDisplay.length === 0 ? `
                <div class="text-center py-12 bg-white rounded-2xl shadow-sm border border-pink-100">
                    <i class="ph ph-package text-6xl text-pink-200 mb-4"></i>
                    <h3 class="text-xl font-semibold text-gray-900 mb-2">${isAdmin ? "Nenhum pedido novo" : "Nenhum pedido ainda"}</h3>
                    <p class="text-gray-600 mb-6">${isAdmin ? "Comece a divulgar sua loja!" : "Fa√ßa sua primeira compra e acompanhe aqui!"}</p>
                    <button onclick="navigate('home')" class="bg-pink-600 text-white px-6 py-2 rounded-lg hover:bg-pink-700 transition">
                        Ir para a Loja
                    </button>
                </div>
            ` : ordersToDisplay.map(order => `
                <div class="bg-white border border-pink-100 rounded-xl p-4 mb-4 hover:shadow-md transition">
                    <div class="flex justify-between items-start mb-4 pb-4 border-b border-pink-50">
                        <div>
                            <p class="font-semibold text-gray-900">Pedido #${order.id.toString().slice(-4)}</p>
                            ${isAdmin ? `<p class="text-sm text-gray-600">Cliente: ${order.customer.name} - ${order.customer.phone}</p>` : ''}
                            <p class="text-sm text-gray-500">${new Date(order.date).toLocaleDateString('pt-BR')}</p>
                        </div>
                        <span class="px-3 py-1 bg-yellow-100 text-yellow-800 text-xs font-medium rounded-full flex items-center gap-1">
                            <i class="ph-fill ph-clock"></i> Pendente
                        </span>
                    </div>
                    <div class="space-y-2 mb-4">
                        ${order.items.map(item => `
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">${item.quantity}x ${item.name}</span>
                                <span class="font-medium">R$ ${(item.price * item.quantity).toFixed(2).replace('.', ',')}</span>
                            </div>
                        `).join('')}
                    </div>
                    <div class="flex justify-between items-center pt-2 border-t border-pink-50 font-bold">
                        <span>Total</span>
                        <span class="text-pink-600">R$ ${order.total.toFixed(2).replace('.', ',')}</span>
                    </div>
                </div>
            `).join('');

            container.innerHTML = `
                <div class="container mx-auto px-4 max-w-2xl">
                    <div class="flex items-center gap-4 mb-8">
                         <button onclick="navigate('home')" class="p-2 hover:bg-pink-100 rounded-full transition">
                            <i class="ph ph-arrow-left text-xl text-pink-600"></i>
                        </button>
                        <h2 class="text-3xl font-bold text-gray-900">${isAdmin ? "Todos os Pedidos" : "Meus Pedidos"}</h2>
                    </div>
                    <div class="space-y-4">
                        ${ordersHTML}
                    </div>
                </div>
            `;
        }
        
        // --- ADMIN MODAL TABS ---

        function setActiveAdminTab(tabName) {
            state.activeAdminTab = tabName;
            // Remove a classe ativa de todos
            document.getElementById('tab-add').classList.remove('tab-active');
            document.getElementById('tab-manage').classList.remove('tab-active');
            document.getElementById('tab-settings').classList.remove('tab-active');
            
            // Adiciona a classe ativa na tab correta
            document.getElementById(`tab-${tabName}`).classList.add('tab-active');

            // Renderiza o conte√∫do
            const adminContent = document.getElementById('admin-content');
            if (tabName === 'add') {
                renderAdminAddProduct(adminContent);
            } else if (tabName === 'manage') {
                renderAdminManageProducts(adminContent);
            } else if (tabName === 'settings') {
                renderAdminSettings(adminContent);
            }
        }
        
        function renderAdminAddProduct(container) {
            container.innerHTML = `
                <form onsubmit="handleNewProductSubmit(event)" class="space-y-6 pt-6">
                    <h3 class="text-lg font-semibold text-gray-900">Adicionar Novo Produto</h3>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Imagens do Produto * (M√∫ltiplas)</label>
                        <label for="product-file-input" class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-pink-300 rounded-xl cursor-pointer hover:border-pink-400 bg-pink-50 transition-colors">
                          <i class="ph ph-upload text-3xl text-pink-400 mb-2"></i>
                          <span class="text-sm text-gray-600" id="file-name-display">
                            Clique para selecionar imagens (Use Ctrl/Cmd para selecionar v√°rias)
                          </span>
                          <input
                            type="file"
                            id="product-file-input"
                            accept="image/*"
                            multiple
                            required
                            onchange="displayFileNames(this.files);"
                            class="hidden"
                          />
                        </label>
                        <p class="text-xs text-red-600 mt-1 font-semibold">
                            ‚ö†Ô∏è Os arquivos selecionados **DEVEM** estar salvos na sua pasta 'assets/'
                        </p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Nome do Produto *</label>
                        <input type="text" id="product-name" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 outline-none" placeholder="Ex: Kit PinkDetalhe">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Descri√ß√£o</label>
                        <textarea id="product-description" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 outline-none" rows="3" placeholder="Adesivos exclusivos, Glitter e Fitilhos"></textarea>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Categoria (opcional)</label>
                            <input type="text" id="product-category" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 outline-none" placeholder="Ex: Kit Completo">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Pre√ßo (R$)</label>
                            <input type="number" step="0.01" min="0" id="product-price" value="29.90" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 outline-none">
                        </div>
                    </div>
                    
                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="product-in-stock" checked class="h-4 w-4 text-pink-600 border-gray-300 rounded focus:ring-pink-500">
                        <label for="product-in-stock" class="text-sm font-medium text-gray-700">Dispon√≠vel em Estoque</label>
                    </div>

                    <button type="submit" class="w-full bg-gradient-to-r from-pink-500 to-pink-600 hover:from-pink-600 hover:to-pink-700 text-white py-3 rounded-xl font-bold text-lg transition flex items-center justify-center gap-2">
                        <i class="ph ph-plus text-xl"></i>
                        Adicionar Produto
                    </button>
                </form>
            `;
        }
        
        // Fun√ß√£o utilit√°ria para mostrar o nome dos arquivos
        function displayFileNames(files) {
            const display = document.getElementById('file-name-display');
            if (files.length === 1) {
                display.textContent = 'Arquivo selecionado: ' + files[0].name;
            } else if (files.length > 1) {
                display.textContent = `${files.length} arquivos selecionados (Principal: ${files[0].name})`;
            } else {
                display.textContent = 'Clique para selecionar imagens (Use Ctrl/Cmd para selecionar v√°rias)';
            }
        }
        
        function handleNewProductSubmit(e) {
            e.preventDefault();
            
            const fileInput = document.getElementById('product-file-input');
            const files = Array.from(fileInput.files);

            if (files.length === 0) {
                 alert("Por favor, selecione pelo menos um arquivo de imagem.");
                 return;
            }

            const image_url = `assets/${files[0].name}`; // Primeira imagem √© a principal
            const image_urls = files.slice(1).map(file => `assets/${file.name}`); // O resto vai para o array

            const name = document.getElementById('product-name').value;
            const price = parseFloat(document.getElementById('product-price').value);
            const description = document.getElementById('product-description').value;
            const category = document.getElementById('product-category').value;
            const in_stock = document.getElementById('product-in-stock').checked;
            
            const newProduct = {
                id: Date.now(), 
                name,
                price,
                image_url,
                image_urls, // Array com as imagens adicionais
                description,
                category: category || null,
                in_stock: in_stock,
            };

            state.products.push(newProduct);
            saveState();
            
            e.target.reset();
            displayFileNames([]); // Limpa o display
            alert(`Produto "${name}" adicionado com sucesso com ${files.length} imagens!`);
            updateProductCount();
            setActiveAdminTab('manage'); 
            navigate('home'); 
        }


        function renderAdminManageProducts(container) {
            const productsList = state.products.map(product => `
                <div class="relative bg-white border border-pink-100 rounded-xl overflow-hidden hover:shadow-lg transition-all group">
                    <img src="${product.image_url}" alt="${product.name}" class="w-full h-32 object-cover">
                    <div class="p-3">
                        <h4 class="font-semibold text-sm mb-1 line-clamp-1">${product.name}</h4>
                        <span class="text-xs font-medium text-pink-700">${product.category || 'N/A'}</span>
                        <p class="text-pink-600 font-bold text-sm mt-1">
                            R$ ${product.price.toFixed(2).replace('.', ',')}
                        </p>
                        <span class="text-xs ${product.in_stock ? 'text-green-600' : 'text-red-600'} font-medium">
                            ${product.in_stock ? 'Em Estoque' : 'Esgotado'} (${(product.image_urls.length || 0) + 1} fotos)
                        </span>
                    </div>
                    <button onclick="deleteProduct(${product.id})" class="absolute top-2 right-2 p-2 bg-red-500 text-white rounded-full h-6 w-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity shadow-lg">
                        <i class="ph ph-trash text-sm"></i>
                    </button>
                </div>
            `).join('');

            container.innerHTML = `
                <div class="pt-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Gerenciar Produtos Cadastrados (${state.products.length})</h3>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                        ${productsList || '<p class="col-span-3 text-center text-gray-500 py-8">Nenhum produto cadastrado.</p>'}
                    </div>
                </div>
            `;
        }
        
        function deleteProduct(productId) {
            if (confirm("Tem certeza que deseja deletar este produto?")) {
                state.products = state.products.filter(p => p.id !== productId);
                saveState();
                updateProductCount();
                setActiveAdminTab('manage'); // Re-renderiza a lista
                navigate('home'); // Atualiza a home
            }
        }
        
        function updateProductCount() {
            const countElement = document.getElementById('product-count');
            if (countElement) {
                countElement.textContent = state.products.length;
            }
        }

        function renderAdminSettings(container) {
            container.innerHTML = `
                <form onsubmit="handleSaveSettings(event)" class="space-y-6 pt-6">
                    <h3 class="text-lg font-semibold text-gray-900 flex items-center gap-2">
                        <i class="ph ph-gear-six text-pink-600"></i> Configura√ß√µes da Loja
                    </h3>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Link do Gateway de Pagamento *</label>
                        <input type="url" id="setting-payment-url" value="${state.settings.payment_gateway_url}" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 outline-none" placeholder="https://link-do-pagamento.com">
                        <p class="text-xs text-gray-500 mt-1">Cole aqui o link do PagSeguro, Mercado Pago, etc.</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Telefone da Loja (WhatsApp)</label>
                        <input type="tel" id="setting-phone" value="${state.settings.store_phone}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 outline-none" placeholder="(00) 00000-0000">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Valor M√≠nimo do Pedido (R$)</label>
                        <input type="number" step="0.01" min="0" id="setting-min-order" value="${state.settings.min_order_value}" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 outline-none">
                    </div>

                    <div class="bg-pink-50 border-pink-200 border rounded-xl p-4 text-sm text-pink-800">
                        <strong>Como funciona:</strong> O cliente ser√° direcionado para o link de pagamento configurado acima ao finalizar a compra. O telefone acima ser√° usado para o bot√£o do WhatsApp.
                    </div>

                    <button type="submit" class="w-full bg-gradient-to-r from-pink-500 to-pink-600 hover:from-pink-600 hover:to-pink-700 text-white py-3 rounded-xl font-bold text-lg transition flex items-center justify-center gap-2">
                        Salvar Configura√ß√µes
                    </button>
                </form>
            `;
        }

        function handleSaveSettings(e) {
            e.preventDefault();
            
            state.settings.payment_gateway_url = document.getElementById('setting-payment-url').value;
            state.settings.store_phone = document.getElementById('setting-phone').value;
            state.settings.min_order_value = parseFloat(document.getElementById('setting-min-order').value);

            saveState();
            alert("Configura√ß√µes salvas com sucesso!");
            navigate('home');
        }


        // --- L√ìGICA DO CARRINHO ---
        function addToCart(productId) {
            const product = state.products.find(p => p.id === productId);
            if (!product || !product.in_stock) return;

            const existingItem = state.cart.find(item => item.id === productId);

            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                state.cart.push({ ...product, quantity: 1 });
            }
            saveState();
            updateCartUI();
            toggleCart(true); 
        }

        function updateCartQuantity(productId, change) {
            const item = state.cart.find(i => i.id === productId);
            if (item) {
                item.quantity += change;
                if (item.quantity <= 0) {
                    state.cart = state.cart.filter(i => i.id !== productId);
                }
            }
            saveState();
            updateCartUI();
        }

        function getCartTotal() {
            return state.cart.reduce((total, item) => total + (item.price * item.quantity), 0);
        }

        function updateCartUI() {
            const cartItemsContainer = document.getElementById('cart-items');
            const cartFooterContainer = document.getElementById('cart-footer');
            const cartBadge = document.getElementById('cart-badge');
            const total = getCartTotal();
            const itemCount = state.cart.reduce((sum, item) => sum + item.quantity, 0);

            // Atualiza Badge
            if (itemCount > 0) {
                cartBadge.textContent = itemCount;
                cartBadge.classList.remove('hidden');
            } else {
                cartBadge.classList.add('hidden');
            }

            // Renderiza Itens
            if (state.cart.length === 0) {
                cartItemsContainer.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-full text-center text-gray-500">
                        <i class="ph ph-shopping-bag text-6xl text-pink-200 mb-4"></i>
                        <p>Seu carrinho est√° vazio</p>
                    </div>
                `;
                cartFooterContainer.innerHTML = '';
            } else {
                cartItemsContainer.innerHTML = state.cart.map(item => `
                    <div class="flex gap-4 p-3 bg-pink-50 rounded-xl border border-pink-100">
                        <img src="${item.image_url}" class="w-16 h-16 object-cover rounded-lg bg-white" alt="${item.name}">
                        <div class="flex-1">
                            <h5 class="font-medium text-gray-900 line-clamp-1">${item.name}</h5>
                            <p class="text-pink-600 font-bold text-sm">R$ ${item.price.toFixed(2).replace('.', ',')}</p>
                            <div class="flex items-center gap-3 mt-2">
                                <div class="flex items-center bg-white rounded-lg border border-pink-200">
                                    <button onclick="updateCartQuantity(${item.id}, -1)" class="px-2 py-1 text-pink-600 hover:bg-pink-50 rounded-l-lg">-</button>
                                    <span class="px-3 text-sm font-medium">${item.quantity}</span>
                                    <button onclick="updateCartQuantity(${item.id}, 1)" class="px-2 py-1 text-pink-600 hover:bg-pink-50 rounded-r-lg">+</button>
                                </div>
                                <button onclick="updateCartQuantity(${item.id}, -${item.quantity})" class="text-red-400 hover:text-red-600 ml-auto">
                                    <i class="ph ph-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');

                const remaining = Math.max(0, state.settings.min_order_value - total);
                const canCheckout = total >= state.settings.min_order_value;

                cartFooterContainer.innerHTML = `
                    ${!canCheckout ? `
                        <div class="mb-4 p-3 bg-yellow-50 text-yellow-800 text-sm rounded-lg flex items-center gap-2">
                            <i class="ph-fill ph-warning-circle text-yellow-500"></i>
                            <span>Adicione mais <strong>R$ ${remaining.toFixed(2).replace('.', ',')}</strong> para o pedido m√≠nimo.</span>
                        </div>
                    ` : ''}
                    <div class="flex justify-between items-center mb-4">
                        <span class="text-lg font-semibold">Total:</span>
                        <span class="text-2xl font-bold text-pink-600">R$ ${total.toFixed(2).replace('.', ',')}</span>
                    </div>
                    <button onclick="toggleCheckout(true)" ${!canCheckout ? 'disabled' : ''} 
                        class="w-full bg-gradient-to-r from-pink-500 to-pink-600 hover:from-pink-600 hover:to-pink-700 text-white py-4 rounded-xl font-bold text-lg shadow-lg transition disabled:opacity-50 disabled:cursor-not-allowed">
                        Finalizar Compra
                    </button>
                `;
            }
        }

        // --- CONTROLE DE MODAIS ---
        function toggleModal(id, show, beforeShow) {
            const modal = document.getElementById(id);
            const modalContent = document.getElementById(id + '-content');
            const overlay = document.getElementById('overlay');
            
            if (show) {
                closeAllModals(id); 
                if (beforeShow) beforeShow();
                modal.classList.remove('hidden', 'pointer-events-none');
                overlay.classList.remove('hidden');
                setTimeout(() => {
                    modalContent.classList.remove('scale-95', 'opacity-0');
                    modalContent.classList.add('scale-100', 'opacity-100');
                }, 10);
            } else {
                modalContent.classList.remove('scale-100', 'opacity-100');
                modalContent.classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    modal.classList.add('hidden', 'pointer-events-none');
                    if (document.getElementById('cart-sidebar').classList.contains('translate-x-full') &&
                        document.getElementById('checkout-modal').classList.contains('hidden') && 
                        document.getElementById('login-modal').classList.contains('hidden') &&
                        document.getElementById('admin-modal').classList.contains('hidden')) {
                         overlay.classList.add('hidden');
                    }
                }, 300); 
            }
        }

        function toggleCart(show) {
            const sidebar = document.getElementById('cart-sidebar');
            const overlay = document.getElementById('overlay');
            if (show) {
                closeAllModals('cart-sidebar');
                updateCartUI();
                sidebar.classList.remove('translate-x-full');
                overlay.classList.remove('hidden');
            } else {
                sidebar.classList.add('translate-x-full');
                if (document.getElementById('checkout-modal').classList.contains('hidden') && 
                    document.getElementById('login-modal').classList.contains('hidden') &&
                    document.getElementById('admin-modal').classList.contains('hidden')) {
                    overlay.classList.add('hidden');
                }
            }
        }
        
        function toggleCheckout(show) { 
            if (show) {
                // Ao abrir, garante que o estado inicial (Step 1) seja renderizado
                state.checkout.step = 1;
                state.checkout.orderId = null;
                state.checkout.formData = { customer_name: "", customer_phone: "" };
            }
            toggleModal('checkout-modal', show, renderCheckoutContent); 
            if (show) toggleCart(false);
        }

        function toggleLogin(show) { toggleModal('login-modal', show, () => document.getElementById('login-error').classList.add('hidden')); }
        
        function toggleAdmin(show) { 
            if (state.isLoggedIn) { 
                toggleModal('admin-modal', show, () => setActiveAdminTab(state.activeAdminTab)); 
                updateProductCount(); 
            } else { 
                toggleLogin(true); 
            } 
        }
        
        function closeAllModals(exceptId) {
            if (exceptId !== 'cart-sidebar') toggleCart(false);
            // Ao fechar, o checkout modal precisa resetar o estado.
            if (exceptId !== 'checkout-modal') {
                toggleModal('checkout-modal', false);
                state.checkout.step = 1; 
                state.checkout.orderId = null;
                state.checkout.formData = { customer_name: "", customer_phone: "" };
            }
            if (exceptId !== 'login-modal') toggleModal('login-modal', false);
            if (exceptId !== 'admin-modal') toggleModal('admin-modal', false);
        }

        // --- RENDERIZA√á√ÉO DO CHECKOUT MODAL (3 ESTADOS) ---

        function renderCheckoutContent() {
            const container = document.getElementById('checkout-modal-content');
            const total = getCartTotal();

            if (state.checkout.step === 3) {
                // ESTADO 3: Pedido Completo (Sucesso)
                 container.innerHTML = `
                    <div class="p-12 text-center w-full">
                        <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6 scale-100">
                            <i class="ph-fill ph-check-circle text-4xl text-green-600"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-900 mb-2">
                            Pedido Recebido! üéâ
                        </h3>
                        <p class="text-gray-600">
                            Obrigado pela sua compra! O seu pedido de *R$ ${total.toFixed(2).replace('.', ',')}* foi registrado.
                        </p>
                        <p class="text-gray-600 mt-2">
                            Entraremos em contato via WhatsApp para confirmar os detalhes de envio.
                        </p>
                        <button onclick="closeAllModals()" class="w-full bg-pink-100 text-pink-600 py-3 rounded-xl font-bold mt-6 hover:bg-pink-200 transition">
                            Voltar √† Loja
                        </button>
                    </div>
                `;
                // Simula o onSuccess que limpa o carrinho e redireciona (se fosse um app real)
                state.cart = [];
                saveState();
                updateCartUI();
                
            } else if (state.checkout.step === 2) {
                // ESTADO 2: Tela de Pagamento
                const orderIdDisplay = state.checkout.orderId ? state.checkout.orderId.toString().slice(-8).toUpperCase() : 'N/A';
                
                container.innerHTML = `
                    <div class="p-8 w-full">
                        <div class="text-center mb-6">
                            <div class="w-16 h-16 bg-pink-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="ph ph-credit-card text-3xl text-pink-600"></i>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-900 mb-2">
                                Finalize seu Pagamento
                            </h3>
                            <p class="text-gray-600">
                                Clique no bot√£o abaixo para ir ao link do Gateway de Pagamento.
                            </p>
                        </div>

                        <div class="bg-pink-50 rounded-xl p-4 mb-6 border border-pink-200">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-gray-700">Total do Pedido:</span>
                                <span class="text-3xl font-bold text-pink-600">
                                    R$ ${total.toFixed(2).replace('.', ',')}
                                </span>
                            </div>
                            <p class="text-xs text-gray-600">
                                Pedido #${orderIdDisplay}
                            </p>
                        </div>

                        <button
                            onclick="handleGatewayRedirect()"
                            class="w-full bg-gradient-to-r from-pink-500 to-pink-600 hover:from-pink-600 hover:to-pink-700 text-white py-4 rounded-xl font-bold text-lg mb-3 flex items-center justify-center gap-2">
                            <i class="ph ph-credit-card text-xl"></i>
                            Ir para Pagamento
                            <i class="ph ph-link-simple text-sm"></i>
                        </button>
                        
                        <button
                            onclick="handlePaymentSkip()"
                            class="w-full border border-pink-300 text-pink-600 py-3 rounded-xl hover:bg-pink-50 transition">
                            Pagar Depois (Marcar como Recebido)
                        </button>
                    </div>
                `;

            } else {
                // ESTADO 1: Formul√°rio de Dados do Cliente
                container.innerHTML = `
                    <>
                        <div class="p-6 border-b border-pink-100 w-full">
                            <div class="flex justify-between items-center">
                                <div>
                                    <h2 class="text-2xl font-bold text-gray-900">
                                        Confirmar Dados
                                    </h2>
                                    <p class="text-sm text-gray-600">
                                        Total: <span class="font-bold text-pink-600">R$ ${total.toFixed(2).replace('.', ',')}</span>
                                    </p>
                                </div>
                                <button
                                    onclick="closeAllModals()"
                                    class="p-2 hover:bg-pink-100 rounded-full text-gray-500 transition">
                                    <i class="ph ph-x text-xl"></i>
                                </button>
                            </div>
                        </div>

                        <form onsubmit="handleOrderCreation(event)" class="p-6 space-y-6">
                            <div class="bg-pink-50 rounded-xl p-4 border border-pink-100">
                                <div class="flex items-center gap-2 mb-3">
                                    <i class="ph ph-package text-xl text-pink-600"></i>
                                    <span class="font-semibold text-gray-900">Seu Pedido</span>
                                </div>
                                <div class="space-y-2 max-h-40 overflow-y-auto">
                                    ${state.cart.map(item => `
                                        <div class="flex justify-between text-sm">
                                            <span class="text-gray-700">
                                                ${item.quantity}x ${item.name}
                                            </span>
                                            <span class="font-medium text-gray-900">
                                                R$ ${((item.price || 4.99) * item.quantity).toFixed(2).replace('.', ',')}
                                            </span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>

                            <div>
                                <label for="customer-name-input" class="block text-sm font-medium text-gray-700 mb-1">Nome Completo *</label>
                                <input
                                    type="text"
                                    id="customer-name-input"
                                    value="${state.checkout.formData.customer_name}"
                                    oninput="state.checkout.formData.customer_name = this.value"
                                    placeholder="Seu nome"
                                    required
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 outline-none"
                                />
                            </div>

                            <div>
                                <label for="customer-phone-input" class="block text-sm font-medium text-gray-700 mb-1">WhatsApp *</label>
                                <input
                                    type="tel"
                                    id="customer-phone-input"
                                    value="${state.checkout.formData.customer_phone}"
                                    oninput="state.checkout.formData.customer_phone = this.value"
                                    placeholder="(00) 00000-0000"
                                    required
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 outline-none"
                                />
                                <p class="text-xs text-gray-500 mt-1">
                                    Usaremos para contato em caso de d√∫vidas.
                                </p>
                            </div>

                            <button
                                type="submit"
                                class="w-full bg-gradient-to-r from-pink-500 to-pink-600 hover:from-pink-600 hover:to-pink-700 text-white py-4 rounded-xl font-bold text-lg transition">
                                <i class="ph ph-credit-card text-xl mr-2"></i>
                                Ir para Pagamento
                            </button>
                        </form>
                    </>
                `;
            }
        }
        
        function handleOrderCreation(e) {
            e.preventDefault();
            
            // Cria o pedido
            const name = document.getElementById('customer-name-input').value;
            const phone = document.getElementById('customer-phone-input').value;
            const total = getCartTotal();

            const newOrder = {
                id: Date.now(),
                date: new Date().toISOString(),
                customer: { name, phone },
                items: [...state.cart],
                total: total,
                status: 'pending',
                customer_address: "A combinar via WhatsApp"
            };
            
            state.orders.push(newOrder);
            state.checkout.orderId = newOrder.id;
            state.checkout.formData = { customer_name: name, customer_phone: phone };
            saveState();

            // Mova para a tela de pagamento
            state.checkout.step = 2;
            renderCheckoutContent();
        }

        function handleGatewayRedirect() {
            const paymentUrl = state.settings.payment_gateway_url;
            
            if (paymentUrl && paymentUrl.startsWith('http')) {
                 // Redireciona para o link configurado (Gateway)
                window.open(paymentUrl, '_blank');
            } else {
                alert("‚ö†Ô∏è Erro: O link do gateway de pagamento n√£o est√° configurado na √°rea CEO. Configure e tente novamente.");
            }
            
            // Move para a tela de sucesso (simulando que o cliente pagou)
            state.checkout.step = 3;
            renderCheckoutContent();
        }

        function handlePaymentSkip() {
            // Se o cliente clicar em Pagar Depois, ele pula para a tela de sucesso
            state.checkout.step = 3;
            renderCheckoutContent();
        }

        // --- L√ìGICA DO CARRINHO, ADMIN e INICIALIZA√á√ÉO (continua a mesma) ---
        // (Fun√ß√µes omitidas por brevidade, mas elas est√£o no c√≥digo completo)

        // RENDERIZA√á√ÉO DA P√ÅGINA INICIAL
        function renderHome(container) {
            const kit = state.products.find(p => p.id === 1) || state.products[0];
            const productImage = kit.image_url;
            const images = [kit.image_url, ...(kit.image_urls || [])].filter(Boolean);

            container.innerHTML = `
                <div class="container mx-auto px-4 py-12 mb-12 text-center">
                    <div class="inline-flex items-center gap-2 px-4 py-2 bg-pink-100 rounded-full mb-6">
                        <i class="ph-fill ph-sparkle text-pink-600"></i>
                        <span class="text-sm font-medium text-pink-600">Kit Completo</span>
                    </div>
                    <h2 class="text-4xl md:text-6xl font-bold mb-6 bg-gradient-to-r from-pink-600 via-pink-500 to-pink-600 bg-clip-text text-transparent leading-tight max-w-4xl mx-auto">
                        Porque seu estilo merece estar em todos os detalhes
                    </h2>
                    <p class="text-lg text-gray-600 mb-8 max-w-2xl mx-auto">
                        Kit completo com adesivos exclusivos, glitter e fitilhos por apenas <span class="font-bold text-pink-600">R$ ${kit.price.toFixed(2).replace('.', ',')}</span>
                    </p>

                    <div class="flex flex-wrap justify-center gap-6 mb-8">
                        <div class="flex items-center gap-2 px-4 py-2 bg-white rounded-xl shadow-sm border border-pink-100">
                            <i class="ph-fill ph-heart text-pink-500"></i>
                            <span class="text-sm text-gray-700">Adesivos exclusivos</span>
                        </div>
                        <div class="flex items-center gap-2 px-4 py-2 bg-white rounded-xl shadow-sm border border-pink-100">
                            <i class="ph-fill ph-star text-pink-500"></i>
                            <span class="text-sm text-gray-700">Glitter</span>
                        </div>
                        <div class="flex items-center gap-2 px-4 py-2 bg-white rounded-xl shadow-sm border border-pink-100">
                            <i class="ph ph-sparkle text-pink-500"></i>
                            <span class="text-sm text-gray-700">Fitilhos</span>
                        </div>
                    </div>

                    <div class="inline-block px-6 py-3 bg-gradient-to-r from-pink-100 to-pink-50 rounded-2xl border border-pink-200">
                        <p class="text-sm text-pink-700">Pedido m√≠nimo: R$ ${state.settings.min_order_value.toFixed(2).replace('.', ',')}</p>
                    </div>
                </div>

                <div class="container mx-auto px-4 py-12">
                    <div class="max-w-5xl mx-auto">
                        <div class="grid md:grid-cols-2 gap-8 md:gap-12 items-center">
                            <div class="order-2 md:order-1">
                                ${images.length > 1 ? renderProductCarouselHTML(kit.id, images) : `
                                    <div class="aspect-square overflow-hidden bg-gradient-to-br from-pink-50 to-white rounded-2xl shadow-xl">
                                        <img src="${productImage}" alt="${kit.name}" class="w-full h-full object-cover">
                                    </div>
                                `}

                                <div class="grid grid-cols-3 gap-4 pt-4 border-t border-pink-200 mt-8">
                                    <div class="text-center">
                                        <div class="text-2xl mb-1">‚ú®</div>
                                        <p class="text-xs text-gray-600">Adesivos Exclusivos</p>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-2xl mb-1">üíñ</div>
                                        <p class="text-xs text-gray-600">Glitter</p>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-2xl mb-1">üéÄ</div>
                                        <p class="text-xs text-gray-600">Fitilhos</p>
                                    </div>
                                </div>
                            </div>

                            <div class="order-1 md:order-2 space-y-6">
                                <span class="text-sm font-semibold text-pink-600 border border-pink-300 px-3 py-1 rounded-full">${kit.category}</span>
                                
                                <h2 class="text-4xl font-bold text-gray-900 leading-snug">
                                    ${kit.name}
                                </h2>

                                <div class="text-lg text-gray-700 leading-relaxed space-y-4">
                                    <p class="font-bold text-pink-800">üíñ KIT PINKDETALHE ‚Äì Detalhes que encantam</p>
                                    <p>${kit.description}</p>
                                </div>
                                
                                <div class="bg-gradient-to-br from-pink-50 to-pink-100 rounded-2xl p-6 border-2 border-pink-200">
                                    <div class="flex items-baseline gap-2 mb-2">
                                        <span class="text-gray-600">Por apenas</span>
                                        <span class="text-5xl font-bold text-pink-600">
                                            R$ ${kit.price.toFixed(2).replace('.', ',')}
                                        </span>
                                    </div>
                                    <p class="text-sm text-pink-700">
                                        ‚ú® Tudo que voc√™ precisa em um √∫nico kit
                                    </p>
                                </div>

                                <button
                                    onclick="addToCart(${kit.id})"
                                    ${!kit.in_stock ? 'disabled' : ''}
                                    class="w-full bg-gradient-to-r from-pink-500 to-pink-600 hover:from-pink-600 hover:to-pink-700 text-white py-4 rounded-xl font-bold text-lg shadow-lg transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 cta-button">
                                    <i class="ph-fill ph-sparkle text-white text-xl transition-transform duration-300"></i>
                                    ${kit.in_stock ? "Adicionar ao Carrinho" : "Esgotado"}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            // Inicializa o carrossel se houver m√∫ltiplas imagens
            if (images.length > 1) {
                setTimeout(() => initProductCarousel(kit.id, images), 10);
            }
        }
        
        // Fun√ß√£o para gerar o HTML do carrossel (sem JS de l√≥gica)
        function renderProductCarouselHTML(productId, images) {
            return `
                <div id="carousel-container-${productId}" class="relative group">
                    <div id="carousel-track-${productId}" class="aspect-square overflow-hidden bg-gradient-to-br from-pink-50 to-white rounded-2xl relative">
                        </div>
                    
                    <button id="carousel-prev-${productId}" class="absolute left-2 top-1/2 -translate-y-1/2 p-3 bg-white/90 hover:bg-white text-gray-700 rounded-full shadow-lg transition-opacity opacity-0 group-hover:opacity-100">
                        <i class="ph ph-chevron-left text-xl"></i>
                    </button>
                    <button id="carousel-next-${productId}" class="absolute right-2 top-1/2 -translate-y-1/2 p-3 bg-white/90 hover:bg-white text-gray-700 rounded-full shadow-lg transition-opacity opacity-0 group-hover:opacity-100">
                        <i class="ph ph-chevron-right text-xl"></i>
                    </button>

                    <div id="carousel-dots-${productId}" class="absolute bottom-4 left-0 right-0 flex justify-center gap-2">
                        </div>
                </div>
            `;
        }

        // L√≥gica de controle do carrossel (JS)
        function initProductCarousel(productId, images) {
            let currentIndex = 0;
            const track = document.getElementById(`carousel-track-${productId}`);
            const prevButton = document.getElementById(`carousel-prev-${productId}`);
            const nextButton = document.getElementById(`carousel-next-${productId}`);
            const dotsContainer = document.getElementById(`carousel-dots-${productId}`);
            const AUTOPLAY_INTERVAL = 3000; // 3 segundos

            if (!track) return; 

            // 1. Renderiza as imagens
            track.innerHTML = images.map((src, index) => `
                <img src="${src}" alt="Imagem ${index + 1}" class="absolute top-0 left-0 w-full h-full object-cover transition-opacity duration-300" 
                    style="opacity: ${index === currentIndex ? 1 : 0};">
            `).join('');
            const carouselImages = track.querySelectorAll('img');

            // 2. Renderiza os dots
            dotsContainer.innerHTML = images.map((_, index) => `
                <button onclick="goToSlide(${productId}, ${index}, ${images.length})" 
                        class="w-2 h-2 rounded-full transition-all duration-300 ${index === currentIndex ? 'bg-pink-600 w-6' : 'bg-white/60 hover:bg-white/80'}">
                </button>
            `).join('');
            const dots = dotsContainer.querySelectorAll('button');

            // Fun√ß√£o para mudar o slide
            window.goToSlide = (id, newIndex, total) => {
                if (id !== productId) return; 
                if (newIndex < 0 || newIndex >= total) return;
                
                // Desativa o slide atual
                carouselImages[currentIndex].style.opacity = 0;
                dots[currentIndex].classList.remove('bg-pink-600', 'w-6');
                dots[currentIndex].classList.add('bg-white/60');
                
                currentIndex = newIndex;
                
                // Ativa o novo slide
                carouselImages[currentIndex].style.opacity = 1;
                dots[currentIndex].classList.add('bg-pink-600', 'w-6');
                dots[currentIndex].classList.remove('bg-white/60');
            };

            // 3. L√≥gica do Autoplay
            let autoplayTimer = setInterval(() => {
                const newIndex = currentIndex === images.length - 1 ? 0 : currentIndex + 1;
                goToSlide(productId, newIndex, images.length);
            }, AUTOPLAY_INTERVAL);

            // 4. Eventos de navega√ß√£o (pausam o autoplay ao interagir)
            const pauseAutoplay = () => {
                clearInterval(autoplayTimer);
                autoplayTimer = setInterval(() => {
                    const newIndex = currentIndex === images.length - 1 ? 0 : currentIndex + 1;
                    goToSlide(productId, newIndex, images.length);
                }, AUTOPLAY_INTERVAL);
            };

            prevButton.onclick = () => {
                const newIndex = currentIndex === 0 ? images.length - 1 : currentIndex - 1;
                goToSlide(productId, newIndex, images.length);
                pauseAutoplay();
            };

            nextButton.onclick = () => {
                const newIndex = currentIndex === images.length - 1 ? 0 : currentIndex + 1;
                goToSlide(productId, newIndex, images.length);
                pauseAutoplay();
            };
            
            dotsContainer.querySelectorAll('button').forEach(button => {
                button.addEventListener('click', pauseAutoplay);
            });
        }


        // RENDERIZA√á√ÉO DA P√ÅGINA DE PEDIDOS
        function renderOrders(container) {
            const isAdmin = state.isLoggedIn;
            const ordersToDisplay = state.orders.slice().reverse(); // Mostra todos os pedidos, do mais recente ao mais antigo.

            const ordersHTML = ordersToDisplay.length === 0 ? `
                <div class="text-center py-12 bg-white rounded-2xl shadow-sm border border-pink-100">
                    <i class="ph ph-package text-6xl text-pink-200 mb-4"></i>
                    <h3 class="text-xl font-semibold text-gray-900 mb-2">${isAdmin ? "Nenhum pedido novo" : "Nenhum pedido ainda"}</h3>
                    <p class="text-gray-600 mb-6">${isAdmin ? "Comece a divulgar sua loja!" : "Fa√ßa sua primeira compra e acompanhe aqui!"}</p>
                    <button onclick="navigate('home')" class="bg-pink-600 text-white px-6 py-2 rounded-lg hover:bg-pink-700 transition">
                        Ir para a Loja
                    </button>
                </div>
            ` : ordersToDisplay.map(order => `
                <div class="bg-white border border-pink-100 rounded-xl p-4 mb-4 hover:shadow-md transition">
                    <div class="flex justify-between items-start mb-4 pb-4 border-b border-pink-50">
                        <div>
                            <p class="font-semibold text-gray-900">Pedido #${order.id.toString().slice(-4)}</p>
                            ${isAdmin ? `<p class="text-sm text-gray-600">Cliente: ${order.customer.name} - ${order.customer.phone}</p>` : ''}
                            <p class="text-sm text-gray-500">${new Date(order.date).toLocaleDateString('pt-BR')}</p>
                        </div>
                        <span class="px-3 py-1 bg-yellow-100 text-yellow-800 text-xs font-medium rounded-full flex items-center gap-1">
                            <i class="ph-fill ph-clock"></i> Pendente
                        </span>
                    </div>
                    <div class="space-y-2 mb-4">
                        ${order.items.map(item => `
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">${item.quantity}x ${item.name}</span>
                                <span class="font-medium">R$ ${(item.price * item.quantity).toFixed(2).replace('.', ',')}</span>
                            </div>
                        `).join('')}
                    </div>
                    <div class="flex justify-between items-center pt-2 border-t border-pink-50 font-bold">
                        <span>Total</span>
                        <span class="text-pink-600">R$ ${order.total.toFixed(2).replace('.', ',')}</span>
                    </div>
                </div>
            `).join('');

            container.innerHTML = `
                <div class="container mx-auto px-4 max-w-2xl">
                    <div class="flex items-center gap-4 mb-8">
                         <button onclick="navigate('home')" class="p-2 hover:bg-pink-100 rounded-full transition">
                            <i class="ph ph-arrow-left text-xl text-pink-600"></i>
                        </button>
                        <h2 class="text-3xl font-bold text-gray-900">${isAdmin ? "Todos os Pedidos" : "Meus Pedidos"}</h2>
                    </div>
                    <div class="space-y-4">
                        ${ordersHTML}
                    </div>
                </div>
            `;
        }
        
        // --- ADMIN MODAL TABS ---

        function setActiveAdminTab(tabName) {
            state.activeAdminTab = tabName;
            // Remove a classe ativa de todos
            document.getElementById('tab-add').classList.remove('tab-active');
            document.getElementById('tab-manage').classList.remove('tab-active');
            document.getElementById('tab-settings').classList.remove('tab-active');
            
            // Adiciona a classe ativa na tab correta
            document.getElementById(`tab-${tabName}`).classList.add('tab-active');

            // Renderiza o conte√∫do
            const adminContent = document.getElementById('admin-content');
            if (tabName === 'add') {
                renderAdminAddProduct(adminContent);
            } else if (tabName === 'manage') {
                renderAdminManageProducts(adminContent);
            } else if (tabName === 'settings') {
                renderAdminSettings(adminContent);
            }
        }
        
        function renderAdminAddProduct(container) {
            container.innerHTML = `
                <form onsubmit="handleNewProductSubmit(event)" class="space-y-6 pt-6">
                    <h3 class="text-lg font-semibold text-gray-900">Adicionar Novo Produto</h3>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Imagens do Produto * (M√∫ltiplas)</label>
                        <label for="product-file-input" class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-pink-300 rounded-xl cursor-pointer hover:border-pink-400 bg-pink-50 transition-colors">
                          <i class="ph ph-upload text-3xl text-pink-400 mb-2"></i>
                          <span class="text-sm text-gray-600" id="file-name-display">
                            Clique para selecionar imagens (Use Ctrl/Cmd para selecionar v√°rias)
                          </span>
                          <input
                            type="file"
                            id="product-file-input"
                            accept="image/*"
                            multiple
                            required
                            onchange="displayFileNames(this.files);"
                            class="hidden"
                          />
                        </label>
                        <p class="text-xs text-red-600 mt-1 font-semibold">
                            ‚ö†Ô∏è Os arquivos selecionados **DEVEM** estar salvos na sua pasta 'assets/'
                        </p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Nome do Produto *</label>
                        <input type="text" id="product-name" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 outline-none" placeholder="Ex: Kit PinkDetalhe">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Descri√ß√£o</label>
                        <textarea id="product-description" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 outline-none" rows="3" placeholder="Adesivos exclusivos, Glitter e Fitilhos"></textarea>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Categoria (opcional)</label>
                            <input type="text" id="product-category" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 outline-none" placeholder="Ex: Kit Completo">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Pre√ßo (R$)</label>
                            <input type="number" step="0.01" min="0" id="product-price" value="29.90" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 outline-none">
                        </div>
                    </div>
                    
                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="product-in-stock" checked class="h-4 w-4 text-pink-600 border-gray-300 rounded focus:ring-pink-500">
                        <label for="product-in-stock" class="text-sm font-medium text-gray-700">Dispon√≠vel em Estoque</label>
                    </div>

                    <button type="submit" class="w-full bg-gradient-to-r from-pink-500 to-pink-600 hover:from-pink-600 hover:to-pink-700 text-white py-3 rounded-xl font-bold text-lg transition flex items-center justify-center gap-2">
                        <i class="ph ph-plus text-xl"></i>
                        Adicionar Produto
                    </button>
                </form>
            `;
        }
        
        // Fun√ß√£o utilit√°ria para mostrar o nome dos arquivos
        function displayFileNames(files) {
            const display = document.getElementById('file-name-display');
            if (files.length === 1) {
                display.textContent = 'Arquivo selecionado: ' + files[0].name;
            } else if (files.length > 1) {
                display.textContent = `${files.length} arquivos selecionados (Principal: ${files[0].name})`;
            } else {
                display.textContent = 'Clique para selecionar imagens (Use Ctrl/Cmd para selecionar v√°rias)';
            }
        }
        
        function handleNewProductSubmit(e) {
            e.preventDefault();
            
            const fileInput = document.getElementById('product-file-input');
            const files = Array.from(fileInput.files);

            if (files.length === 0) {
                 alert("Por favor, selecione pelo menos um arquivo de imagem.");
                 return;
            }

            const image_url = `assets/${files[0].name}`; // Primeira imagem √© a principal
            const image_urls = files.slice(1).map(file => `assets/${file.name}`); // O resto vai para o array

            const name = document.getElementById('product-name').value;
            const price = parseFloat(document.getElementById('product-price').value);
            const description = document.getElementById('product-description').value;
            const category = document.getElementById('product-category').value;
            const in_stock = document.getElementById('product-in-stock').checked;
            
            const newProduct = {
                id: Date.now(), 
                name,
                price,
                image_url,
                image_urls, // Array com as imagens adicionais
                description,
                category: category || null,
                in_stock: in_stock,
            };

            state.products.push(newProduct);
            saveState();
            
            e.target.reset();
            displayFileNames([]); // Limpa o display
            alert(`Produto "${name}" adicionado com sucesso com ${files.length} imagens!`);
            updateProductCount();
            setActiveAdminTab('manage'); 
            navigate('home'); 
        }


        function renderAdminManageProducts(container) {
            const productsList = state.products.map(product => `
                <div class="relative bg-white border border-pink-100 rounded-xl overflow-hidden hover:shadow-lg transition-all group">
                    <img src="${product.image_url}" alt="${product.name}" class="w-full h-32 object-cover">
                    <div class="p-3">
                        <h4 class="font-semibold text-sm mb-1 line-clamp-1">${product.name}</h4>
                        <span class="text-xs font-medium text-pink-700">${product.category || 'N/A'}</span>
                        <p class="text-pink-600 font-bold text-sm mt-1">
                            R$ ${product.price.toFixed(2).replace('.', ',')}
                        </p>
                        <span class="text-xs ${product.in_stock ? 'text-green-600' : 'text-red-600'} font-medium">
                            ${product.in_stock ? 'Em Estoque' : 'Esgotado'} (${(product.image_urls.length || 0) + 1} fotos)
                        </span>
                    </div>
                    <button onclick="deleteProduct(${product.id})" class="absolute top-2 right-2 p-2 bg-red-500 text-white rounded-full h-6 w-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity shadow-lg">
                        <i class="ph ph-trash text-sm"></i>
                    </button>
                </div>
            `).join('');

            container.innerHTML = `
                <div class="pt-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Gerenciar Produtos Cadastrados (${state.products.length})</h3>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                        ${productsList || '<p class="col-span-3 text-center text-gray-500 py-8">Nenhum produto cadastrado.</p>'}
                    </div>
                </div>
            `;
        }
        
        function deleteProduct(productId) {
            if (confirm("Tem certeza que deseja deletar este produto?")) {
                state.products = state.products.filter(p => p.id !== productId);
                saveState();
                updateProductCount();
                setActiveAdminTab('manage'); // Re-renderiza a lista
                navigate('home'); // Atualiza a home
            }
        }
        
        function updateProductCount() {
            const countElement = document.getElementById('product-count');
            if (countElement) {
                countElement.textContent = state.products.length;
            }
        }

        function renderAdminSettings(container) {
            container.innerHTML = `
                <form onsubmit="handleSaveSettings(event)" class="space-y-6 pt-6">
                    <h3 class="text-lg font-semibold text-gray-900 flex items-center gap-2">
                        <i class="ph ph-gear-six text-pink-600"></i> Configura√ß√µes da Loja
                    </h3>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Link do Gateway de Pagamento *</label>
                        <input type="url" id="setting-payment-url" value="${state.settings.payment_gateway_url}" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 outline-none" placeholder="https://link-do-pagamento.com">
                        <p class="text-xs text-gray-500 mt-1">Cole aqui o link do PagSeguro, Mercado Pago, etc.</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Telefone da Loja (WhatsApp)</label>
                        <input type="tel" id="setting-phone" value="${state.settings.store_phone}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 outline-none" placeholder="(00) 00000-0000">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Valor M√≠nimo do Pedido (R$)</label>
                        <input type="number" step="0.01" min="0" id="setting-min-order" value="${state.settings.min_order_value}" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 outline-none">
                    </div>

                    <div class="bg-pink-50 border-pink-200 border rounded-xl p-4 text-sm text-pink-800">
                        <strong>Como funciona:</strong> O cliente ser√° direcionado para o link de pagamento configurado acima ao finalizar a compra. O telefone acima ser√° usado para o bot√£o do WhatsApp.
                    </div>

                    <button type="submit" class="w-full bg-gradient-to-r from-pink-500 to-pink-600 hover:from-pink-600 hover:to-pink-700 text-white py-3 rounded-xl font-bold text-lg transition flex items-center justify-center gap-2">
                        Salvar Configura√ß√µes
                    </button>
                </form>
            `;
        }

        function handleSaveSettings(e) {
            e.preventDefault();
            
            state.settings.payment_gateway_url = document.getElementById('setting-payment-url').value;
            state.settings.store_phone = document.getElementById('setting-phone').value;
            state.settings.min_order_value = parseFloat(document.getElementById('setting-min-order').value);

            saveState();
            alert("Configura√ß√µes salvas com sucesso!");
            navigate('home');
        }


        // --- L√ìGICA DO CARRINHO ---
        function addToCart(productId) {
            const product = state.products.find(p => p.id === productId);
            if (!product || !product.in_stock) return;

            const existingItem = state.cart.find(item => item.id === productId);

            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                state.cart.push({ ...product, quantity: 1 });
            }
            saveState();
            updateCartUI();
            toggleCart(true); 
        }

        function updateCartQuantity(productId, change) {
            const item = state.cart.find(i => i.id === productId);
            if (item) {
                item.quantity += change;
                if (item.quantity <= 0) {
                    state.cart = state.cart.filter(i => i.id !== productId);
                }
            }
            saveState();
            updateCartUI();
        }

        function getCartTotal() {
            return state.cart.reduce((total, item) => total + (item.price * item.quantity), 0);
        }

        function updateCartUI() {
            const cartItemsContainer = document.getElementById('cart-items');
            const cartFooterContainer = document.getElementById('cart-footer');
            const cartBadge = document.getElementById('cart-badge');
            const total = getCartTotal();
            const itemCount = state.cart.reduce((sum, item) => sum + item.quantity, 0);

            // Atualiza Badge
            if (itemCount > 0) {
                cartBadge.textContent = itemCount;
                cartBadge.classList.remove('hidden');
            } else {
                cartBadge.classList.add('hidden');
            }

            // Renderiza Itens
            if (state.cart.length === 0) {
                cartItemsContainer.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-full text-center text-gray-500">
                        <i class="ph ph-shopping-bag text-6xl text-pink-200 mb-4"></i>
                        <p>Seu carrinho est√° vazio</p>
                    </div>
                `;
                cartFooterContainer.innerHTML = '';
            } else {
                cartItemsContainer.innerHTML = state.cart.map(item => `
                    <div class="flex gap-4 p-3 bg-pink-50 rounded-xl border border-pink-100">
                        <img src="${item.image_url}" class="w-16 h-16 object-cover rounded-lg bg-white" alt="${item.name}">
                        <div class="flex-1">
                            <h5 class="font-medium text-gray-900 line-clamp-1">${item.name}</h5>
                            <p class="text-pink-600 font-bold text-sm">R$ ${item.price.toFixed(2).replace('.', ',')}</p>
                            <div class="flex items-center gap-3 mt-2">
                                <div class="flex items-center bg-white rounded-lg border border-pink-200">
                                    <button onclick="updateCartQuantity(${item.id}, -1)" class="px-2 py-1 text-pink-600 hover:bg-pink-50 rounded-l-lg">-</button>
                                    <span class="px-3 text-sm font-medium">${item.quantity}</span>
                                    <button onclick="updateCartQuantity(${item.id}, 1)" class="px-2 py-1 text-pink-600 hover:bg-pink-50 rounded-r-lg">+</button>
                                </div>
                                <button onclick="updateCartQuantity(${item.id}, -${item.quantity})" class="text-red-400 hover:text-red-600 ml-auto">
                                    <i class="ph ph-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');

                const remaining = Math.max(0, state.settings.min_order_value - total);
                const canCheckout = total >= state.settings.min_order_value;

                cartFooterContainer.innerHTML = `
                    ${!canCheckout ? `
                        <div class="mb-4 p-3 bg-yellow-50 text-yellow-800 text-sm rounded-lg flex items-center gap-2">
                            <i class="ph-fill ph-warning-circle text-yellow-500"></i>
                            <span>Adicione mais <strong>R$ ${remaining.toFixed(2).replace('.', ',')}</strong> para o pedido m√≠nimo.</span>
                        </div>
                    ` : ''}
                    <div class="flex justify-between items-center mb-4">
                        <span class="text-lg font-semibold">Total:</span>
                        <span class="text-2xl font-bold text-pink-600">R$ ${total.toFixed(2).replace('.', ',')}</span>
                    </div>
                    <button onclick="toggleCheckout(true)" ${!canCheckout ? 'disabled' : ''} 
                        class="w-full bg-gradient-to-r from-pink-500 to-pink-600 hover:from-pink-600 hover:to-pink-700 text-white py-4 rounded-xl font-bold text-lg shadow-lg transition disabled:opacity-50 disabled:cursor-not-allowed">
                        Finalizar Compra
                    </button>
                `;
            }
        }

        // --- CONTROLE DE MODAIS ---
        function toggleModal(id, show, beforeShow) {
            const modal = document.getElementById(id);
            const modalContent = document.getElementById(id + '-content');
            const overlay = document.getElementById('overlay');
            
            if (show) {
                closeAllModals(id); 
                if (beforeShow) beforeShow();
                modal.classList.remove('hidden', 'pointer-events-none');
                overlay.classList.remove('hidden');
                setTimeout(() => {
                    modalContent.classList.remove('scale-95', 'opacity-0');
                    modalContent.classList.add('scale-100', 'opacity-100');
                }, 10);
            } else {
                modalContent.classList.remove('scale-100', 'opacity-100');
                modalContent.classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    modal.classList.add('hidden', 'pointer-events-none');
                    if (document.getElementById('cart-sidebar').classList.contains('translate-x-full') &&
                        document.getElementById('checkout-modal').classList.contains('hidden') && 
                        document.getElementById('login-modal').classList.contains('hidden') &&
                        document.getElementById('admin-modal').classList.contains('hidden')) {
                         overlay.classList.add('hidden');
                    }
                }, 300); 
            }
        }

        function toggleCart(show) {
            const sidebar = document.getElementById('cart-sidebar');
            const overlay = document.getElementById('overlay');
            if (show) {
                closeAllModals('cart-sidebar');
                updateCartUI();
                sidebar.classList.remove('translate-x-full');
                overlay.classList.remove('hidden');
            } else {
                sidebar.classList.add('translate-x-full');
                if (document.getElementById('checkout-modal').classList.contains('hidden') && 
                    document.getElementById('login-modal').classList.contains('hidden') &&
                    document.getElementById('admin-modal').classList.contains('hidden')) {
                    overlay.classList.add('hidden');
                }
            }
        }
        
        function toggleCheckout(show) { 
            if (show) {
                // Ao abrir, garante que o estado inicial (Step 1) seja renderizado
                state.checkout.step = 1;
                state.checkout.orderId = null;
                state.checkout.formData = { customer_name: "", customer_phone: "" };
            }
            toggleModal('checkout-modal', show, renderCheckoutContent); 
            if (show) toggleCart(false);
        }

        function toggleLogin(show) { toggleModal('login-modal', show, () => document.getElementById('login-error').classList.add('hidden')); }
        
        function toggleAdmin(show) { 
            if (state.isLoggedIn) { 
                toggleModal('admin-modal', show, () => setActiveAdminTab(state.activeAdminTab)); 
                updateProductCount(); 
            } else { 
                toggleLogin(true); 
            } 
        }
        
        function closeAllModals(exceptId) {
            if (exceptId !== 'cart-sidebar') toggleCart(false);
            // Ao fechar, o checkout modal precisa resetar o estado.
            if (exceptId !== 'checkout-modal') {
                toggleModal('checkout-modal', false);
                state.checkout.step = 1; 
                state.checkout.orderId = null;
                state.checkout.formData = { customer_name: "", customer_phone: "" };
            }
            if (exceptId !== 'login-modal') toggleModal('login-modal', false);
            if (exceptId !== 'admin-modal') toggleModal('admin-modal', false);
        }
        
        // --- CHECKOUT ---
        function handleOrderCreation(e) {
            e.preventDefault();
            
            // Cria o pedido
            const name = document.getElementById('customer-name-input').value;
            const phone = document.getElementById('customer-phone-input').value;
            const total = getCartTotal();

            const newOrder = {
                id: Date.now(),
                date: new Date().toISOString(),
                customer: { name, phone },
                items: [...state.cart],
                total: total,
                status: 'pending',
                customer_address: "A combinar via WhatsApp"
            };
            
            state.orders.push(newOrder);
            state.checkout.orderId = newOrder.id;
            state.checkout.formData = { customer_name: name, customer_phone: phone };
            saveState();

            // Mova para a tela de pagamento
            state.checkout.step = 2;
            renderCheckoutContent();
        }

        function handleGatewayRedirect() {
            const paymentUrl = state.settings.payment_gateway_url;
            
            if (paymentUrl && paymentUrl.startsWith('http')) {
                 // Redireciona para o link configurado (Gateway)
                window.open(paymentUrl, '_blank');
            } else {
                alert("‚ö†Ô∏è Erro: O link do gateway de pagamento n√£o est√° configurado na √°rea CEO.");
            }
            
            // Move para a tela de sucesso (simulando que o cliente pagou)
            state.checkout.step = 3;
            renderCheckoutContent();
        }

        function handlePaymentSkip() {
            // Se o cliente clicar em Pagar Depois, ele pula para a tela de sucesso
            state.checkout.step = 3;
            renderCheckoutContent();
        }

        // RENDERIZA√á√ÉO DO CHECKOUT MODAL (3 ESTADOS) ---
        function renderCheckoutContent() {
            const container = document.getElementById('checkout-modal-content');
            const total = getCartTotal();

            if (state.checkout.step === 3) {
                // ESTADO 3: Pedido Completo (Sucesso)
                 container.innerHTML = `
                    <div class="p-12 text-center w-full">
                        <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6 scale-100">
                            <i class="ph-fill ph-check-circle text-4xl text-green-600"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-900 mb-2">
                            Pedido Recebido! üéâ
                        </h3>
                        <p class="text-gray-600">
                            Obrigado pela sua compra! O seu pedido de *R$ ${total.toFixed(2).replace('.', ',')}* foi registrado.
                        </p>
                        <p class="text-gray-600 mt-2">
                            Entraremos em contato via WhatsApp para confirmar os detalhes de envio.
                        </p>
                        <button onclick="closeAllModals()" class="w-full bg-pink-100 text-pink-600 py-3 rounded-xl font-bold mt-6 hover:bg-pink-200 transition">
                            Voltar √† Loja
                        </button>
                    </div>
                `;
                // Limpa o carrinho e garante que o estado seja salvo
                state.cart = [];
                saveState();
                updateCartUI();
                
            } else if (state.checkout.step === 2) {
                // ESTADO 2: Tela de Pagamento
                const orderIdDisplay = state.checkout.orderId ? state.checkout.orderId.toString().slice(-8).toUpperCase() : 'N/A';
                
                container.innerHTML = `
                    <div class="p-8 w-full">
                        <div class="text-center mb-6">
                            <div class="w-16 h-16 bg-pink-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="ph ph-credit-card text-3xl text-pink-600"></i>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-900 mb-2">
                                Finalize seu Pagamento
                            </h3>
                            <p class="text-gray-600">
                                Clique no bot√£o abaixo para ir ao link do Gateway de Pagamento.
                            </p>
                        </div>

                        <div class="bg-pink-50 rounded-xl p-4 mb-6 border border-pink-200">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-gray-700">Total do Pedido:</span>
                                <span class="text-3xl font-bold text-pink-600">
                                    R$ ${total.toFixed(2).replace('.', ',')}
                                </span>
                            </div>
                            <p class="text-xs text-gray-600">
                                Pedido #${orderIdDisplay}
                            </p>
                        </div>

                        <button
                            onclick="handleGatewayRedirect()"
                            class="w-full bg-gradient-to-r from-pink-500 to-pink-600 hover:from-pink-600 hover:to-pink-700 text-white py-4 rounded-xl font-bold text-lg mb-3 flex items-center justify-center gap-2">
                            <i class="ph ph-credit-card text-xl"></i>
                            Ir para Pagamento
                            <i class="ph ph-link-simple text-sm"></i>
                        </button>
                        
                        <button
                            onclick="handlePaymentSkip()"
                            class="w-full border border-pink-300 text-pink-600 py-3 rounded-xl hover:bg-pink-50 transition">
                            Pagar Depois (Marcar como Recebido)
                        </button>
                    </div>
                `;

            } else {
                // ESTADO 1: Formul√°rio de Dados do Cliente
                container.innerHTML = `
                    <>
                        <div class="p-6 border-b border-pink-100 w-full">
                            <div class="flex justify-between items-center">
                                <div>
                                    <h2 class="text-2xl font-bold text-gray-900">
                                        Confirmar Dados
                                    </h2>
                                    <p class="text-sm text-gray-600">
                                        Total: <span class="font-bold text-pink-600">R$ ${total.toFixed(2).replace('.', ',')}</span>
                                    </p>
                                </div>
                                <button
                                    onclick="closeAllModals()"
                                    class="p-2 hover:bg-pink-100 rounded-full text-gray-500 transition">
                                    <i class="ph ph-x text-xl"></i>
                                </button>
                            </div>
                        </div>

                        <form onsubmit="handleOrderCreation(event)" class="p-6 space-y-6">
                            <div class="bg-pink-50 rounded-xl p-4 border border-pink-100">
                                <div class="flex items-center gap-2 mb-3">
                                    <i class="ph ph-package text-xl text-pink-600"></i>
                                    <span class="font-semibold text-gray-900">Seu Pedido</span>
                                </div>
                                <div class="space-y-2 max-h-40 overflow-y-auto">
                                    ${state.cart.map(item => `
                                        <div class="flex justify-between text-sm">
                                            <span class="text-gray-700">
                                                ${item.quantity}x ${item.name}
                                            </span>
                                            <span class="font-medium text-gray-900">
                                                R$ ${((item.price || 4.99) * item.quantity).toFixed(2).replace('.', ',')}
                                            </span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>

                            <div>
                                <label for="customer-name-input" class="block text-sm font-medium text-gray-700 mb-1">Nome Completo *</label>
                                <input
                                    type="text"
                                    id="customer-name-input"
                                    value="${state.checkout.formData.customer_name}"
                                    oninput="state.checkout.formData.customer_name = this.value"
                                    placeholder="Seu nome"
                                    required
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 outline-none"
                                />
                            </div>

                            <div>
                                <label for="customer-phone-input" class="block text-sm font-medium text-gray-700 mb-1">WhatsApp *</label>
                                <input
                                    type="tel"
                                    id="customer-phone-input"
                                    value="${state.checkout.formData.customer_phone}"
                                    oninput="state.checkout.formData.customer_phone = this.value"
                                    placeholder="(00) 00000-0000"
                                    required
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 outline-none"
                                />
                                <p class="text-xs text-gray-500 mt-1">
                                    Usaremos para contato em caso de d√∫vidas.
                                </p>
                            </div>

                            <button
                                type="submit"
                                class="w-full bg-gradient-to-r from-pink-500 to-pink-600 hover:from-pink-600 hover:to-pink-700 text-white py-4 rounded-xl font-bold text-lg transition">
                                <i class="ph ph-credit-card text-xl mr-2"></i>
                                Ir para Pagamento
                            </button>
                        </form>
                    </>
                `;
            }
        }
        // --- FUN√á√ïES ADMIN/CARRINHO OMITIDAS POR BREVIDADE ---
        // Fun√ß√µes completas est√£o na √°rea de c√≥digo acima.

        // --- INICIALIZA√á√ÉO ---
        document.addEventListener('DOMContentLoaded', () => {
            updateAuthButton();
            updateProductCount();
            navigate('home');
            updateCartUI();
        });

    </script>
</body>
</html>
